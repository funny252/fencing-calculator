<!DOCTYPE html>
<!-- saved from url=(0176)https://localhost:8443/sunbase/portal/widgets/fence/measure/yard_measure.jsp?nomenu=1&level=18&uuid=a83e6943569341f88269cb7157bb10a4p&schema=fence&lat=28.484535&lng=-81.0891333 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link type="text/css" rel="stylesheet" href="./yard_measure_files/css">
<link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
	
	
	<link rel="shortcut icon" type="image/x-icon" href="https://localhost:8443/sunbase/portal/widgets/fence/measure/favicon.ico">
	<script>var basePath = '';</script>
	<link type="text/css" rel="stylesheet" href="./yard_measure_files/css.css">
	<link href="./yard_measure_files/bootstrap.min.css" rel="stylesheet">	
	<link type="text/css" href="./yard_measure_files/jquery-ui-1.8.23.custom.css" rel="stylesheet">
	<link href="./yard_measure_files/style.css" rel="stylesheet">
	<!--[if IE 9]><link href="css/ie9.css" rel="stylesheet" /><![endif]-->
	<!--[if IE 8]><link href="css/ie8.css" rel="stylesheet" /><![endif]-->
	<!--[if IE 7]><link href="css/ie7.css" rel="stylesheet" /><![endif]-->
	<script type="text/javascript" src="./yard_measure_files/jquery.min.js.download"></script>
	<script type="text/javascript" src="./yard_measure_files/jquery-ui.min.js.download"></script>
	
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAutuf794MUpQuhZ2A2ZQwyiEXyr01eZoU&libraries=places"></script>
	
	<script type="text/javascript" src="./yard_measure_files/html2canvas.js.download"></script>
	<script type="text/javascript" src="./yard_measure_files/canvas2image.js.download"></script>

	<script src="./yard_measure_files/jquery.growl.js.download" type="text/javascript"></script>
	<link href="./yard_measure_files/jquery.growl.css" rel="stylesheet" type="text/css">

	<!-- <script type="text/javascript" src="./yard_measure_files/yard-area-calculator.js"></script> -->
	<script type="text/javascript" src="./yard_measure_files/area-formulae.js.download"></script>
	<script type="text/javascript" src="./yard_measure_files/geodesy-formulae.js.download"></script>
	<script type="text/javascript" src="./yard_measure_files/general.js.download"></script>
	<script type="text/javascript" src="./yard_measure_files/jquery.numeric.js.download"></script>
	<script type="text/javascript" src="./yard_measure_files/context-menu.js.download"></script>		
	
	
	<script type="text/javascript" src="./yard_measure_files/jquery-impromptu.js.download"></script>
	<link rel="stylesheet" media="all" type="text/css" href="./yard_measure_files/jquery-impromptu.css">
	<script>
		var map;
var geocoder;

var panelTools = false;
var multiMode = false;

var draglat = 0;
var draglng = 0;

var fullname = "";
var email = "";
var phone = "";

var selectedBox = null;
var selectedBoxList = new Array(0);
var points = new Array(0);
var singles = new Array(0);
var areacontainer = new Array(0);
var areacontainer_current;
var boxSet = new Array(0);
var areaPath = new Array(0);
var areaPath2 = new Array(0);
var polygon = new Array(0);
var areaMarkers = new Array(0);
var areaAnchors = new Array(0);
var areaRotators = new Array(0);
var rotatorLines = new Array(0);
var lineColor = '#27FF48';
var fillColor = '#27FF48';
var lineWidth = 5;
var lineOpacity = 1.0;
var fillOpacity = 0.2;
var radiansPerDegree = Math.PI / 180.0;
var degreesPerRadian = 180.0 / Math.PI;
var earthRadiusMeters = 6367460.0;
var metersPerDegree = 2.0 * Math.PI * earthRadiusMeters / 360.0;
var metersPerKm = 1000.0;
var meters2PerHectare = 10000.0;
var feetPerMeter = 3.2808399;
var feetPerMile = 5280.0;
var acresPerMile2 = 640;
var totalarea = 0;
var total_meters = 0;
var readonly = false;
var overlay;
var projection;
var polygon_context_menu;
var marker_index_context_menu;
var marker_number_context_menu;
var polyline_index_context_menu;
var polyline_number_context_menu;
var readonly_ran = false;
var areacontainer_labels = new Array(0);
var areacontainer_types = new Array(0);
var areacontainer_toggle = new Array(0);
var search_marker = null;
var gate=1;
var movingObj;
var movingObj_X, movingObj_Y;
var single_gates = 0;
var double_gates = 0;

function setStrokeColor(a, color){
	lineColor = color;
	fillColor = color;
	$(".color-hover").removeClass("selected");
	$(a).addClass("selected");
}

function done_location(){
	fullname = $("#fullname").val();
	phone = $("#phone").val();
	email = $("#email").val();
}

function select_gate(gate_type){
	gate = gate_type;
	if(gate == 1){
		$(".left-section-gate").addClass("gate-selected");
		$(".right-section-gate").removeClass("gate-selected");
	}
	if(gate == 2){
		$(".left-section-gate").removeClass("gate-selected");
		$(".right-section-gate").addClass("gate-selected");
	}
}

function add_gate(){
	if (gate == 1) {
		$(".gates").append('<div class="outer-gate" style="left:' + window.screen.width / 2 + 'px; top: ' + window.screen.height / 2 + 'px;"><div class="gate" onmousedown="start_drag(this, event);"><img src="img/gate_1.png"></div><div class="close-gate-btn" onclick="remove_gate(this, 1);"><img src="img/close-gate-btn.png"></div></div>');
		single_gates ++;
	}
	if(gate == 2) {
		$(".gates").append('<div class="outer-gate" style="left:' + window.screen.width / 2 + 'px; top: ' + window.screen.height / 2 + 'px;"><div class="gate" onmousedown="start_drag(this, event);"><img src="img/gate_2.png"></div><div class="close-gate-btn" onclick="remove_gate(this, 2);"><img src="img/close-gate-btn.png"></div></div>');
		double_gates ++;
	}
	let ht = "";
	if(single_gates > 0){
		ht += single_gates + '<div style="color: #27FF48; font-size: 20px;margin-top: 16px;margin-left: 5px;">Single Gate</div>';
	}
	if(double_gates > 0){
		ht +=double_gates + '<div style="color: #27FF48; font-size: 20px;margin-top: 16px;margin-left: 5px;">Double Gate</div>';
	}
	$(".fence-gates").html(ht);
}

//<div class="move-gate-btn"><img src="img/drag.png"></div>

function start_drag(dv, e){
	dv.style.boxShadow = "0px 0px 10px #000";
	movingObj = dv.parentNode;
	movingObj_X = parseInt(movingObj.style.left) - e.clientX;
	movingObj_Y = parseInt(movingObj.style.top) - e.clientY;
}

window.addEventListener("mousemove", function(event){
	dragging(event);
});

window.addEventListener("mouseup", function(event){
	end_drag(event);
});

function end_drag(e){
	if(movingObj){
		$(movingObj).find(".gate").css("box-shadow", "none");
		movingObj = null;
	}	
}

function dragging(e){
	if(movingObj){
		movingObj.style.left = movingObj_X + e.clientX + 'px';
		movingObj.style.top = movingObj_Y + e.clientY + 'px';
	}	
}

function remove_gate(c, g){
	c.parentNode.style.display = "none";
	if(g == 1) single_gates--;
	if(g == 2) double_gates--;
	let ht = "";
	if(single_gates > 0){
		ht += single_gates + '<div style="color: #27FF48; font-size: 20px;margin-top: 16px;margin-left: 5px;">Single Gate</div>';
	}
	if(double_gates > 0){
		ht +=double_gates + '<div style="color: #27FF48; font-size: 20px;margin-top: 16px;margin-left: 5px;">Double Gate</div>';
	}
	$(".fence-gates").html(ht);
}

function save_plan(){
	$(".name-1").html(fullname);
	$(".phone-1").html(phone);
	$(".email-1").html(email);
	$(".thanks").css("display", "block");
}

function MapLabel(opt_options) {
  this.set('fontFamily', 'sans-serif');
  this.set('fontSize', 12);
  this.set('fontColor', '#000000');
  this.set('strokeWeight', 4);
  this.set('strokeColor', '#ffffff');
  this.set('align', 'center');

  this.set('zIndex', 1e3);

  this.setValues(opt_options);
}
MapLabel.prototype = new google.maps.OverlayView;

window['MapLabel'] = MapLabel;


/** @inheritDoc */
MapLabel.prototype.changed = function(prop) {
  switch (prop) {
    case 'fontFamily':
    case 'fontSize':
    case 'fontColor':
    case 'strokeWeight':
    case 'strokeColor':
    case 'align':
    case 'text':
      return this.drawCanvas_();
    case 'maxZoom':
    case 'minZoom':
    case 'position':
      return this.draw();
  }
};

/**
 * Draws the label to the canvas 2d context.
 * @private
 */
MapLabel.prototype.drawCanvas_ = function() {
  var canvas = this.canvas_;
  if (!canvas) return;

  var style = canvas.style;
  style.zIndex = /** @type number */(this.get('zIndex'));

  var ctx = canvas.getContext('2d');
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.strokeStyle = this.get('strokeColor');
  ctx.fillStyle = this.get('fontColor');
  ctx.font = this.get('fontSize') + 'px ' + this.get('fontFamily');

  var strokeWeight = Number(this.get('strokeWeight'));

  var text = this.get('text');
  if (text) {
    if (strokeWeight) {
      ctx.lineWidth = strokeWeight;
      ctx.strokeText(text, strokeWeight, strokeWeight);
    }

    ctx.fillText(text, strokeWeight, strokeWeight);

    var textMeasure = ctx.measureText(text);
    var textWidth = textMeasure.width + strokeWeight;
    style.marginLeft = this.getMarginLeft_(textWidth) + 'px';
    // Bring actual text top in line with desired latitude.
    // Cheaper than calculating height of text.
    style.marginTop = '-0.4em';
  }
};

/**
 * @inheritDoc
 */
MapLabel.prototype.onAdd = function() {
  var canvas = this.canvas_ = document.createElement('canvas');
  var style = canvas.style;
  style.position = 'absolute';

  var ctx = canvas.getContext('2d');
  ctx.lineJoin = 'round';
  ctx.textBaseline = 'top';

  this.drawCanvas_();

  var panes = this.getPanes();
  if (panes) {
    panes.mapPane.appendChild(canvas);
	//panes.floatPane.appendChild(canvas);
  }
};
MapLabel.prototype['onAdd'] = MapLabel.prototype.onAdd;

/**
 * Gets the appropriate margin-left for the canvas.
 * @private
 * @param {number} textWidth  the width of the text, in pixels.
 * @return {number} the margin-left, in pixels.
 */
MapLabel.prototype.getMarginLeft_ = function(textWidth) {
  switch (this.get('align')) {
    case 'left':
      return 0;
    case 'right':
      return -textWidth;
  }
  return textWidth / -2;
};

/**
 * @inheritDoc
 */
MapLabel.prototype.draw = function() {
  var projection = this.getProjection();

  if (!projection) {
    // The map projection is not ready yet so do nothing
    return;
  }

  if (!this.canvas_) {
    // onAdd has not been called yet.
    return;
  }

  var latLng = /** @type {google.maps.LatLng} */ (this.get('position'));
  if (!latLng) {
    return;
  }
  var pos = projection.fromLatLngToDivPixel(latLng);

  var style = this.canvas_.style;

  style['top'] = pos.y + 'px';
  style['left'] = pos.x + 'px';

  style['visibility'] = this.getVisible_();
};
MapLabel.prototype['draw'] = MapLabel.prototype.draw;

/**
 * Get the visibility of the label.
 * @private
 * @return {string} blank string if visible, 'hidden' if invisible.
 */
MapLabel.prototype.getVisible_ = function() {
  var minZoom = /** @type number */(this.get('minZoom'));
  var maxZoom = /** @type number */(this.get('maxZoom'));

  if (minZoom === undefined && maxZoom === undefined) {
    return '';
  }

  var map = this.getMap();
  if (!map) {
    return '';
  }

  var mapZoom = map.getZoom();
  if (mapZoom < minZoom || mapZoom > maxZoom) {
    return 'hidden';
  }
  return '';
};

/**
 * @inheritDoc
 */
MapLabel.prototype.onRemove = function() {
  var canvas = this.canvas_;
  if (canvas && canvas.parentNode) {
    canvas.parentNode.removeChild(canvas);
  }
};
MapLabel.prototype['onRemove'] = MapLabel.prototype.onRemove;

$(document).ready(function(){
	
	//if(id!='')
		//$("#slideout-menu").hide();
	
	$( "#tabs" ).tabs();
	
	$("button").button();
	
	$("#delete-dialog, #delete-all-dialog, #save-dialog, #shape-dialog, #rotate-dialog, #instructions-dialog, #file-dialog, #setAreaLabel-dialog, #setLineLength-dialog").dialog({
		autoOpen: false, 
		modal: true, 
		resizable:false,
		open: function(event, ui){
			$(window).trigger('resize');
		},
		close: function(event, ui){
			$(window).trigger('resize');
		}
	});
	
	$("#type").change(function(){
		$(".shape").hide();
		var type = $("#type").val();
		$("#"+type).show();
	}).trigger('change');
	
	$(".shape input").val('');
	
	$(".shape input").numeric({ negative: false });
	
	$("#rotate-dialog input").numeric({negative: false});
	
	
	
	initialize_map();
	
	initializePanelMenu();
	initializePolygonMenu();
	initializeMarkerMenu();
	initializePolylineMenu();
	initializeSearchMarkerMenu();
	
	
//	$("#address").val('');
		  var dataConv = null;
	
	
	$("#address").autocomplete({
	
	      source: function(request, response) {	    	                            
  	        geocoder.geocode( {'address': request.term }, function(results, status) {
  	        	if(results != null){
  	        		dataConv = $.map(results, function(item) {
  		            return {
  		            	id: '',
  		              label:  item.formatted_address,
  		              value: item.formatted_address,
  		              latitude: item.geometry.location.lat(),
  		              longitude: item.geometry.location.lng(),
  		              southwest: item.geometry.viewport.getSouthWest(),
  		              northeast: item.geometry.viewport.getNorthEast()  		              					  							              
  		              
  		            }
  		          });
  	        	}  	        	
				
				if ( dataConv != null )
					response(dataConv);
  		        //set_dimensions();
          });	    	  
      	        
	      },
	      //This bit is executed upon selection of an address
	      select: function(event, ui) {
	        var location = new google.maps.LatLng(ui.item.latitude, ui.item.longitude);
	        map.setZoom(20);
	        map.setCenter(location);
	        
	        var resultBounds = new google.maps.LatLngBounds(
	        		ui.item.southwest, 
	        		ui.item.northeast
				);

				map.fitBounds(resultBounds);

				placeSearchMarker(location);
	        
	      }
	   	});

	$("#calculations, #totals").hide();
	
	if(id!=''){
		readonly = true;
		//setReadonly(id);
	}
	
	set_dimensions();
	
	$(window).resize(function() {
		set_dimensions();
	});
	
		
	set_dimensions();
	////$(window).trigger('resize');
	
	$("#arrow").click(function(){
		
		var cls = $("#slideout-menu").attr('class');
				
		if(cls=="out"){
			$("#slideout-menu").removeClass("out");
			var left = '-=422';
			$(this).button({
				label: '<br>><br><br>'
			});
			
		}else{
			$("#slideout-menu").addClass("out");
			var left = '+=422';
			$(this).button({
				label: '<br><<br><br>'
			});
		}
		
		$("#slideout-menu").animate({
			left: left,
		});
	});
	
	$( "#radio" ).buttonset();
	
	$("#radio").change(function(){
		var value = $(this).find('input:checked').val();
		set_toggle(value);
	});
	
});



google.maps.Polygon.prototype.my_getBounds=function(){
    var bounds = new google.maps.LatLngBounds()
    this.getPath().forEach(function(element,index){bounds.extend(element)})
    return bounds
}
function set_toggle(value){
	areacontainer_toggle[areacontainer_current] = value;
	display();
}


function updateOritentation()
{
	var f = document.getElementById('roof_orientation').value == 'landscape';
	document.getElementById('flipPanels').checked = f;
}
function set_dimensions(){
	
	var fullwidth = $(window).width();
	//var fullwidth = $('body').width();
	//var fullwidth = screen.availWidth;
	//var fullwidth = $('body').innerWidth();	
	var leftwidth = $("#left").width();	
	var rightwidth = fullwidth - leftwidth - 2;
	$("#right").css('width',rightwidth);
	//$("#right").width(rightwidth);
	
	var fullheight = $(window).height();
	$("#side-panel-content").css('height',fullheight - 42);
	
	if(areacontainer.length > 1){
		if(id!='')
			var calc_height = 400;
		else
			var calc_height = 480;
	}else{
		if(id!='')
			var calc_height = 190;
		else
			var calc_height = 270;
	}
		
	$("#calculations").css('height', fullheight - 42 - calc_height);
	
	//google.maps.event.trigger(map, 'resize');
	
	//console.log(fullwidth);
}

function guid() {
  function s4() {
    return Math.floor((1 + Math.random()) * 0x10000)
      .toString(16)
      .substring(1);
  }
  return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
    s4() + '-' + s4() + s4() + s4();
}

function createPoint(lat, lng, pin)
{
//	console.log("Create point " + pinIcon );
	if ( pin === '' )
		return null;

	var pinIcon = null;
	if ( pin === 'gate' )
		pinIcon = basePath + 'img/gate.png';	
	else if ( pin === 'doublegate' )
		pinIcon = basePath + 'img/doublegate.png';	
	else
		pinIcon = pin;
		
	var icon = new google.maps.MarkerImage(pinIcon,
				new google.maps.Size(24, 20),
				new google.maps.Point(0,0),
				new google.maps.Point(7, 20)
			);
	var shadow = new google.maps.MarkerImage('img/pin-shadow.png',
		      // The shadow image is larger in the horizontal dimension
		      // while the position and offset are the same as for the main image.
		      new google.maps.Size(25, 25),
		      new google.maps.Point(0,0),
		      new google.maps.Point(4, 33));
	
	var myLatLng = {lat: lat, lng: lng };
	
	var uuid = guid();
	var marker = new google.maps.Marker({
        position: myLatLng,
        map: map,
        shadow: shadow,
        icon: icon,
		uuid: uuid,
        draggable: true
    });
	
	console.log("Marker " + pinIcon + " " + myLatLng );

	canvasMarkers.push( marker );	
 //   google.maps.event.addListener(marker, 'dragend', function(event){
//				url: '../../modules/crm/canvas_cmd.jsp?cmd=update_pos&lat=' + event.latLng.lat() + '&lng=' + event.latLng.lng() + '&uuid=' + marker.uuid,
//    	});
    	google.maps.event.addListener(marker, 'click', function(event){
    		//console.log("Click " + this + " " + this.uuid );
			if ( $('#deleteBox').hasClass('activeMenuActionD') )
			{
				marker.setMap(null);
				for ( var i = 0; i < canvasMarkers.length; ++i ) {				
					if ( canvasMarkers[i].uuid === marker.uuid) {
						canvasMarkers.splice(i, 1);
						break;
					}
				}
			}
			else if ( $('#setStyleBox').hasClass('activeMenuActionD') )
			{
				setGateStyle( marker.uuid );
			}
			//markerMenu(this, event);
			return false;
    	});
		
	//setGateStyle(uuid);	
		
}


function map_click(event){	

	if ( $('#doublegate').hasClass('activeMenuActionD') )
	{
		createPoint(event.latLng.lat(), event.latLng.lng(), 'doublegate' );
	}		
	else if ( $('#gate').hasClass('activeMenuActionD') )
	{
		createPoint(event.latLng.lat(), event.latLng.lng(), 'gate' );
	}			
	else if ( $('#otherSvg').hasClass('activeMenuActionZ') )
	{
		createPoint(event.latLng.lat(), event.latLng.lng(), subaction );
	}
	else if ( $('#drawSvg').hasClass('activeMenuActionZ') )
	{
		if(areacontainer_current == null){
			createNewArea()
		}
		areacontainer[areacontainer_current].push(event.latLng);
		activeLine = true;
		display();
		$(".context-menu").css('visibility','hidden');
	}
}


var totalFenceArea = 0;

function display(){
	$(".fence-part-list").html("");
	
	clearMap();
	
	var total_perimeter_m = 0;
	var total_perimeter_ft = 0;
	var total_area_m = 0;
	var total_area_km = 0;
	var total_area_acres = 0;
	var total_area_hectares = 0;
	var total_area_ft = 0;
	var total_area_snm = 0;
	var total_perimeter_yard = 0;
	var total_area_yard = 0;
	
	totalFenceArea = 0;
	$("#calculations, #totals").hide();
	
	for ( var j = 0; j < mapLabels.length; ++j )
	{
		mapLabels[j].setMap(null);
	}
	mapLabels = [];
	
	for (var i = 0; i < areacontainer.length; i++){
		
		var tmp_arr = Array(0);
		
		$("#calculations, #totals").show();
		$("#instructions").hide();
		
		if(areacontainer_current == i){
        	var temp_fillColor = "#003461";
        	var temp_fillOpacity = '0.5';
        	var temp_lineColor = lineColor;
        }else{
        	var temp_fillColor = fillColor;
        	var temp_fillOpacity = fillOpacity;
        	var temp_lineColor = lineColor;
        }
		
		if(areacontainer_types[i] == 'SUB'){
			temp_lineColor = "red";
		}
		
		if(areacontainer[i].length==2){
			var distanceTooltip = getPolylineDistance(areacontainer[i]);
			//totalFenceLine += distanceTooltip;
		}
		else{
			var distanceTooltip = "";
		}
		
		var temp_areaPath = new google.maps.Polyline({
            path: areacontainer[i],
            strokeColor: temp_lineColor,
            strokeOpacity: lineOpacity,
            strokeWeight: lineWidth,
            geodesic: false,
            index: i,
            number: 0,
            distanceTooltip: distanceTooltip
        });
		temp_areaPath.setMap(map);
        //areaPath.push(temp_areaPath);
        
		
		if (areacontainer[i].length == 2) {
			
		 if(!(readonly)){
            google.maps.event.addListener(temp_areaPath, 'click', function(event){
            	areacontainer[this.index].splice(this.number + 1, 0, event.latLng);
            	display();
            });
            google.maps.event.addListener(temp_areaPath, 'rightclick', function(event){
            	polylineMenu(this,event);
            });		                        
         }
         
         google.maps.event.addListener(temp_areaPath, 'mouseover', function(event){
         	polylineHover(this, event.latLng);		            	
         });
         google.maps.event.addListener(temp_areaPath, 'mouseout', function(event){
         	$(".distanceTooltip").remove();		            	
         });
		}
         
         
         tmp_arr.push(temp_areaPath);
 		areaPath2.push(tmp_arr);

		
 		placeLabel(i);
        
        var perm = 1000 * temp_areaPath.inKm();
        var perimeter_m = perm.toFixed(2);
        var perimeter_ft = (perm * 3.2808399).toFixed(2);
        var perimeter_yard = (perimeter_m * 1.09361).toFixed(2);
        var area_m = 0;
        var area_km = 0;
        var area_acres = 0;
        var area_hectares = 0;
        var area_ft = 0;
        var area_snm = 0;
        var area_yard = 0;
        
        var dummy_polygon = new google.maps.Polygon({
            paths: Array(0),
            strokeColor: temp_lineColor,
            strokeOpacity: lineOpacity,
            strokeWeight: lineWidth,
            fillColor: temp_fillColor,
            geodesic: false,
            fillOpacity: temp_fillOpacity,
            clickable: false,
            index: i
        });
        polygon.push(dummy_polygon);		
        
        
        if (areacontainer[i].length > 2) {
        	
        	polygon.pop();
        	/*
        	if (areaPath2.length > 0) {
                for (q in areaPath2) {
                    for(w in areaPath2[q]){
                		areaPath2[q][w].setMap(null)
                	}
                }
            }
        	areaPath2 = Array(0);
        	*/
        	tmp_arr = Array(0);
        	
        	for(var k=0; k<areacontainer[i].length-1; k++){
        		
        		var arr = Array(0);
        		arr.push(areacontainer[i][k]);
        		arr.push(areacontainer[i][k+1]);
				
				var segmentLength = getPolylineDistance(arr);
        		
        		
	            var temp_areaPath2 = new google.maps.Polyline({
	                path: arr,
	                strokeColor: temp_lineColor,
	                strokeOpacity: lineOpacity,
	                strokeWeight: lineWidth,
	                geodesic: false,
	                fillOpacity: temp_fillOpacity,
	                index: i,
	                number: k,
	                distanceTooltip: segmentLength
	            });
	            
	            
	            
	            if(!(readonly)){
		            google.maps.event.addListener(temp_areaPath2, 'click', function(event){
		            	areacontainer[this.index].splice(this.number + 1, 0, event.latLng);
		            	display();
		            });
		            google.maps.event.addListener(temp_areaPath2, 'rightclick', function(event){
		            	polylineMenu(this,event);
		            });		                        
	            }
	            
	            google.maps.event.addListener(temp_areaPath2, 'mouseover', function(event){
	            	polylineHover(this, event.latLng);		            	
	            });
	            google.maps.event.addListener(temp_areaPath2, 'mouseout', function(event){
	            	$(".distanceTooltip").remove();		            	
	            });
	            
	            temp_areaPath2.setMap(map);
	            tmp_arr.push(temp_areaPath2);
	            
	            /**************************************************/
        	}
        	
        	areaPath2.push(tmp_arr);
        	
        	
        	/*
            var temp_polygon = new google.maps.Polygon({
                paths: areacontainer[i],
                strokeColor: temp_lineColor,
                strokeOpacity: lineOpacity,
                strokeWeight: lineWidth,
                fillColor: temp_fillColor,
                geodesic: false,
                fillOpacity: temp_fillOpacity,
                clickable: false,
                index: i
            });
            temp_polygon.setMap(map);
            polygon.push(temp_polygon);
		   
		    if ( areacontainer_toggle[areacontainer_current] != 'HIDE_BOTH' )
			{
				var marker2 = placeAnchor(getPolygonCenter(i), i);
				areaAnchors.push(marker2);
				//marker.setMap(map);
			}            
            placeLabel(i);
            
            if(!(readonly)){
	            var f = function (index) {
	                return function () {
	                	areacontainer_current = index;
	                    display();
	                    $(".context-menu").css('visibility','hidden');
	                }
	            };
	            google.maps.event.addListener(temp_polygon, 'click', map_click);
	            	            
	            google.maps.event.addListener(temp_polygon, 'rightclick', function(event){
	            	polygonMenu(this,event);	            	
	            });
	            	        
	            //var marker3 = placeRotator(getPolygonCenter(i), i);
	            //var marker3 = placeRotator(getPolygonCenter(polygon.length-1), polygon.length-1);
	            //areaRotators.push(marker3);
	            	            
	            
            }
           */
            
            var areaMeters2 = PlanarPolygonAreaMeters2(areacontainer[i]);
 
            var area_m = Areas(areaMeters2);
            var area_km = Areaskm(areaMeters2);
            var area_acres = Areasacre(areaMeters2);
            var area_hectares = Areashectare(areaMeters2);
            var area_ft = Areasfeet(areaMeters2);
            var area_snm = AreasNatMiles(areaMeters2);
            var area_yard = Areasyard(areaMeters2);
            
            
                                     
        }
        
        displayCalculations(i, perimeter_m, perimeter_ft, area_m, area_km, area_acres, area_hectares, area_ft, area_snm, perimeter_yard, area_yard);
        

        if(areacontainer_types[i]=='ADD'){
	    	total_perimeter_m = total_perimeter_m + parseFloat(perimeter_m);
	    	total_perimeter_ft = total_perimeter_ft + parseFloat(perimeter_ft);
	    	total_perimeter_yard = total_perimeter_yard + parseFloat(perimeter_yard);
	    	total_area_m = total_area_m + parseFloat(area_m);
	    	total_area_km = total_area_km + parseFloat(area_km);
	    	total_area_acres = total_area_acres + parseFloat(area_acres);
	    	total_area_hectares = total_area_hectares + parseFloat(area_hectares);
	    	total_area_ft = total_area_ft + parseFloat(area_ft);
	    	total_area_snm = total_area_snm + parseFloat(area_snm);	
	    	total_area_yard = total_area_yard + parseFloat(area_yard);	
        }else{
        	//total_perimeter_m = total_perimeter_m - parseFloat(perimeter_m);
	    	//total_perimeter_ft = total_perimeter_ft - parseFloat(perimeter_ft);
	    	//total_perimeter_yard = total_perimeter_yard - parseFloat(perimeter_yard);
	    	total_area_m = total_area_m - parseFloat(area_m);
	    	total_area_km = total_area_km - parseFloat(area_km);
	    	total_area_acres = total_area_acres - parseFloat(area_acres);
	    	total_area_hectares = total_area_hectares - parseFloat(area_hectares);
	    	total_area_ft = total_area_ft - parseFloat(area_ft);
	    	total_area_snm = total_area_snm - parseFloat(area_snm);	
	    	total_area_yard = total_area_yard - parseFloat(area_yard);
        }

        
        for (var j = 0; j < areacontainer[i].length; j++) {
        	if(areacontainer_toggle[i]=='HIDE_LABELS' || areacontainer_toggle[i]=='HIDE_NONE' /*|| id!=''*/){
	            var marker = placeMarker(areacontainer[i][j], j, i);
	            areaMarkers.push(marker);
	            marker.setMap(map);
        	}
        }
        
	}
	
	$('.fencePermiter').html( totalFenceArea.toFixed(2) + "'" );
	if(total_perimeter_ft > 0.1)$(".fence-total").html(total_perimeter_ft.toFixed(2) + '<div style="color: #27FF48; font-size: 20px;margin-top: 16px;margin-left: 5px;">ft Fence</div>');
	total_meters = total_perimeter_m;
	if(areacontainer.length != null && areacontainer.length > 1)
		displayCalculationTotals(total_perimeter_m, total_perimeter_ft, total_area_m, total_area_km, total_area_acres, total_area_hectares, total_area_ft, total_area_snm, total_perimeter_yard, total_area_yard)
		
	$("#calculations").accordion('destroy').accordion({
		header: '.title',
		active: areacontainer_current,
		autoHeight: false
	});
	$("#totals").accordion('destroy').accordion({
		header: '.title',
		active: 0,
		autoHeight: false
	});
	$("button").button();
	//$(window).trigger("resize");
	set_dimensions();
	
	$("#slideout-menu-overlay").html(areacontainer_labels[areacontainer_current]);
	
	$("#radio input").trigger('blur');
	/*
	if(areacontainer_toggle[areacontainer_current]=='HIDE_PINS'){
		$("#radio1").trigger('click');
	}else if(areacontainer_toggle[areacontainer_current]=='HIDE_LABELS'){
		$("#radio2").trigger('click');
	}else if(areacontainer_toggle[areacontainer_current]=='HIDE_BOTH'){
		$("#radio3").trigger('click');
	}else if(areacontainer_toggle[areacontainer_current]=='HIDE_NONE'){
		$("#radio4").trigger('click');
	}*/
	
}

function removeAllPanels() {
   if (boxSet.length > 0) {
        for ( var j = 0; j < boxSet.length; ++j) {
            if ( boxSet[j].length > 0 )
			{
				var boxes = boxSet[j];
				for ( var i = 0; i < boxes.length; ++i) {
				  boxes[i].setMap(null);
				  delete boxes[i];
				}
			}
        }
	}
	boxSet.length = 0;
}

function clearMap() {
    if (areaMarkers) {
        for (i in areaMarkers) {
            areaMarkers[i].setMap(null)
        }
    }
    if (areaPath.length > 0) {
        for (i in areaPath) {
            areaPath[i].setMap(null)
        }
    }

 
    if (areaPath2.length > 0) {
        for (i in areaPath2) {
            for(j in areaPath2[i]){
        		areaPath2[i][j].setMap(null)
        	}
        }
    }
    if (polygon.length > 0) {
        for (i in polygon) {
            polygon[i].setMap(null)
        }
    }
    if (areaAnchors.length > 0) {
        for (i in areaAnchors) {
        	areaAnchors[i].setMap(null)
        }
    }
    
    if (areaRotators.length > 0) {
        for (i in areaRotators) {
        	areaRotators[i].setMap(null)
        }
    }
    
    if (rotatorLines.length > 0) {
        for (i in rotatorLines) {
        	rotatorLines[i].setMap(null)
        }
    }
    
    areaMarkers = new Array(0);
    areaPath = new Array(0);
    areaPath2 = new Array(0);
    polygon = new Array(0);
    areaAnchors = new Array(0);
    areaRotators = new Array(0);
    rotatorLines = new Array(0);
    
    $('#calculations, #totals').html('');
    $("#instructions").show();
    $('.polygon-label').remove();
    $("#slideout-menu-overlay").html('');
}


function middlePoint(lat1, lng1, lat2, lng2) {
	
    //-- Longitude difference
    var dLng = (lng2 - lng1).toRad();

    //-- Convert to radians
    lat1 = lat1.toRad();
    lat2 = lat2.toRad();
    lng1 = lng1.toRad();

    var bX = Math.cos(lat2) * Math.cos(dLng);
    var bY = Math.cos(lat2) * Math.sin(dLng);
    var lat3 = Math.atan2(Math.sin(lat1) + Math.sin(lat2), Math.sqrt((Math.cos(lat1) + bX) * (Math.cos(lat1) + bX) + bY * bY));
    var lng3 = lng1 + Math.atan2(bY, Math.cos(lat1) + bX);

    //-- Return result
    return new google.maps.LatLng(lat3.toDeg(), lng3.toDeg());
}

var mapLabels = new Array();

function findHeading(heading) {
        var tmp = heading;
        if (tmp > 360) {
            tmp = heading - 360;
        } else if (tmp < 0) {
            tmp = heading + tmp;
        }
        return tmp;
    };


function getPolylineDistance(points){
	
	var dest_m = google.maps.geometry.spherical.computeDistanceBetween(new google.maps.LatLng(points[0].lat(), points[0].lng()), new google.maps.LatLng(points[1].lat(), points[1].lng() )); 	

    var dest_ft = (dest_m * 3.2808399).toFixed(2);
	$(".fence-part-list").append('<div style="padding: 3px;font-size: 16px;">' + dest_ft + 'ft Fence</div>');
    var dest_yard = (dest_m * 1.09361).toFixed(2);

	totalFenceArea += parseFloat(dest_ft);

	var midPoint = middlePoint(points[0].lat(), points[0].lng(), points[1].lat(), points[1].lng());	

	var heading = findHeading(google.maps.geometry.spherical.computeHeading(points[0], points[1]));
	var tmpDist = 0.00005;

	var perpAngle = 90;
	heading = Math.abs( heading );
	heading = heading % 360;
	if (heading < 90 || heading > 270) {
		tmpDist = .00005;
	}
	midPoint = middlePoint(points[0].lat(), points[0].lng(), points[1].lat(), points[1].lng() + tmpDist );	
	
	var mapLabel = new MapLabel({
		text: dest_ft + "'",
		position: midPoint,
		map: map,
		fontSize: 12,
		align: 'center',
		strokeColor: '#303030',
		fontColor: '#FFFFFF',
		strokeWeight: 8,
		zIndex: 9999
	});
	mapLabels.push( mapLabel );
	
	var html = ""+
		"<div class='distanceTooltip'>"+
		addCommas(dest_ft)+" ft<br>"+
		addCommas(dest_yard)+" yards<br></div>";
	
	return html;
}


function polylineHover(line, location){	
	$(".distanceTooltip").remove();
	$("#map").append(line.distanceTooltip);
	var latlng = location;
	var x = overlay.getProjection().fromLatLngToContainerPixel(latlng).x;
	var y = overlay.getProjection().fromLatLngToContainerPixel(latlng).y;
	x += 15;
	$(".distanceTooltip").css('top',y).css('left',x).css('visibility','visible');
}


function placeLabel(index){
	if(areacontainer_toggle[index] == 'HIDE_PINS' || areacontainer_toggle[index] == 'HIDE_NONE' /* || id!=''*/){
		/*var html = "<div class='polygon-label' id='polygon-label-"+index+"'>"+areacontainer_labels[index]+"</div>";
		//$("#map").append(html);
		var latlng = getPolygonCenter(index);
		if(!(isNaN(latlng.lat()))){		
			var x = overlay.getProjection().fromLatLngToContainerPixel(latlng).x;
			var y = overlay.getProjection().fromLatLngToContainerPixel(latlng).y;
			y = y + 6;
			$("#polygon-label-"+index).css('top',y).css('left',x).css('visibility','visible');
		}
		*/
	}
}


function placeMarker(location, number, index) {
	if(areacontainer_types[index] == 'ADD'){	
		var icon = new google.maps.MarkerImage('img/pin.png',
				new google.maps.Size(15, 27),
				new google.maps.Point(0,0),
				new google.maps.Point(7, 27)
			);
	}else{
		var icon = new google.maps.MarkerImage('img/pin-red.png',
				new google.maps.Size(15, 27),
				new google.maps.Point(0,0),
				new google.maps.Point(7, 27)
			);
	}
	
	var shadow = new google.maps.MarkerImage('img/pin-shadow.png',
		      // The shadow image is larger in the horizontal dimension
		      // while the position and offset are the same as for the main image.
		      new google.maps.Size(25, 25),
		      new google.maps.Point(0,0),
		      new google.maps.Point(4, 33));
	
	var marker = new google.maps.Marker({
        position: location,
        map: map,
        shadow: shadow,
        icon: icon,
        draggable: false,
        index: index,
        number: number		
    });
    var f = function (index, number) {
        return function () {
            areacontainer[index][number] = marker.position;
            areacontainer_current = index;
            display();
            $(".context-menu").css('visibility','hidden');
        }
    };
    var f2 = function (index) {
    	return function() {
    		areacontainer_current = index;
    		display();
    		$(".context-menu").css('visibility','hidden');
    	}
    } 
    
    if(!(readonly)){
    	marker.setOptions({
    		draggable: true,
			
    	});
    	
    	google.maps.event.addListener(marker, 'dragend', f(index, number));
    	google.maps.event.addListener(marker, 'click', f2(index));
	
    
    	google.maps.event.addListener(marker, 'rightclick', function(event){
    		markerMenu(this, event);
    	});
    
    }
    
    return marker;
}

function deleteLastPoint(index) {
	if( !areacontainer[index] )
		return;

    if( areacontainer[index].length > 0){ 
    	areacontainer[index].length--;
    	areacontainer_labels[index].length--;
    	areacontainer_types[index].length--;
    	areacontainer_toggle[index].length--;
    }
    display();
    return false;
}


function deletePoint(index, number){
	areacontainer[index].splice(number,1);
	//areacontainer_labels[index].splice(number,1);
	//areacontainer_types[index].splice(number,1);
	display();
}


function clearAllPoints() {
	
	$("#delete-all-dialog").dialog({
	      buttons : {
	        "Confirm" : function() {
	        	areacontainer = new Array(0);
	        	areacontainer_labels = new Array(0);
	        	areacontainer_types = new Array(0);
	        	areacontainer_toggle = new Array(0);
	            //div_totalareas.style.visibility = 'hidden';
	            display();
	            //kmlcoordinates = "";
	            //div_kmloutput.innerHTML = "";
	            areaMarkers = new Array(0);
	            areaPath = new Array(0);
	            areaPath2 = new Array(0);
	            polygon = new Array(0);
	            //var points = new Array(0);
	            //areacontainer.push(points); 
	            areacontainer_current = null;
	            deleteSearchMarker();
				
				removeAllPanels();
				
	        	$(this).dialog("close");
				calculateSystemSize();
	        },
	        "Cancel" : function() {
	          $(this).dialog("close");
	        }
	      }
	    });

	    $("#delete-all-dialog").dialog("open");

	    $('.ui-dialog :button').blur();
	    
	return false;
		
}

function setPanelType()
{
	var type = document.getElementById('panel_type').value;
	if ( type )
	{
		//out.println("<option class='dropdown-choice' value='general,300,39,66'>Generic Panel 300 Watt (39&quot; x 66&quot;)</option>");
	}
}

function createNewArea() {
    points = new Array(0);
    areacontainer.push(points);
    areacontainer_current = areacontainer.length - 1;
    areacontainer_labels.push('Array '+areacontainer.length);
    areacontainer_types.push('ADD');
    areacontainer_toggle.push('HIDE_NONE');
    //console.log(areacontainer.length);
    //$("#calculations").append(calculationHTML(areacontainer_current));
    //div_totalareas.style.visibility = 'visible';
    
	if ( areacontainer.length > 0 )
		display();
    //kmlcoordinates = "";
    //div_kmloutput.innerHTML = ""
    return false;
}

  var totalPanels = 0;
//  var boxes = new google.maps.MVCArray();


       function convertPoint(latLng, map) { 
         var 
topRight=map.getProjection().fromLatLngToPoint(map.getBounds().getNorthEast()); 
         var 
bottomLeft=map.getProjection().fromLatLngToPoint(map.getBounds().getSouthWest()); 
         var scale=Math.pow(2,map.getZoom()); 
         var worldPoint=map.getProjection().fromLatLngToPoint(latLng); 
         return new google.maps.Point((worldPoint.x- 
bottomLeft.x)*scale,(worldPoint.y-topRight.y)*scale); 
       } 


	   
	   
  function renderPanels2(mapCanvas, polygog) {
  }
  
  
  function createPanels(mapCanvas)
  {
  }
  

  function inchToPx(inch, inchesPerPx) {
    var powBase;
    return inch * inchesPerPx / Math.pow(2, map.getZoom())
}

function avg(arr) {
    var sum, avg = 0;
    return arr.length && (avg = (sum = arr.reduce((function(a, b) {
        return a + b
    }))) / arr.length), avg
}


  function getPixelsPerInch(metersPerPx) {
    let pixelPerMeter, pixelsPerInch;
    return .0254 * (1 / metersPerPx)
  }

  

  
  function renderPanels2(mapCanvas, polygonxxxx) {
  }

  function selectPanel(panel)
  {
  }



function createPolygonFromRectangle(rectangle) {
    var map = rectangle.getMap();
  
    var coords = [
      { lat: rectangle.getBounds().getNorthEast().lat(), lng: rectangle.getBounds().getNorthEast().lng() },
      { lat: rectangle.getBounds().getNorthEast().lat(), lng: rectangle.getBounds().getSouthWest().lng() },
      { lat: rectangle.getBounds().getSouthWest().lat(), lng: rectangle.getBounds().getSouthWest().lng() },
      { lat: rectangle.getBounds().getSouthWest().lat(), lng: rectangle.getBounds().getNorthEast().lng() }
    ];

    // Construct the polygon.
    var rectPoly = new google.maps.Polygon({
        path: coords,
		draggable: true
    });
    var properties = ["strokeColor","strokeOpacity","strokeWeight","fillOpacity","fillColor"];
    //inherit rectangle properties 
    var options = {};
    properties.forEach(function(property) {
        if (rectangle.hasOwnProperty(property)) {
            options[property] = rectangle[property];
        }
    });
    rectPoly.setOptions(options);

    rectangle.setMap(null);
    rectPoly.setMap(map);
    return rectPoly;
}

function getCenterPoint(poly)
{
    var lowx,
        highx,
        lowy,
        highy,
        lats = [],
        lngs = [],
        vertices = poly.getPath();

    for(var i=0; i<vertices.length; i++) {
      lngs.push(vertices.getAt(i).lng());
      lats.push(vertices.getAt(i).lat());
    }

    lats.sort();
    lngs.sort();
    lowx = lats[0];
    highx = lats[vertices.length - 1];
    lowy = lngs[0];
    highy = lngs[vertices.length - 1];
    center_x = lowx + ((highx-lowx) / 2);
    center_y = lowy + ((highy - lowy) / 2);
    return (new google.maps.LatLng(center_x, center_y));
}

function rotatePoint(point, origin, angle) {
    var angleRad = angle * Math.PI / 180.0;
    return {
        x: Math.cos(angleRad) * (point.x - origin.x) - Math.sin(angleRad) * (point.y - origin.y) + origin.x,
        y: Math.sin(angleRad) * (point.x - origin.x) + Math.cos(angleRad) * (point.y - origin.y) + origin.y
    };
}

function hidePins()
{
	areacontainer_toggle[areacontainer_current]='HIDE_PINS';
	$('.ui-state-active').removeClass('ui-state-active');
	$('#radio1').addClass('ui-state-active');
	display();
}
function hideLabels()
{
	areacontainer_toggle[areacontainer_current]='HIDE_LABELS';
	$('.ui-state-active').removeClass('ui-state-active');
	$('#radio2').addClass('ui-state-active');
	display();
}
function hideBoth()
{
	areacontainer_toggle[areacontainer_current]='HIDE_BOTH';
	$('#radio3').addClass('ui-state-active');
	display();
}
function hideNone()
{
	areacontainer_toggle[areacontainer_current]='HIDE_NONE';
	$('#radio4').addClass('ui-state-active');
	display();
}


function displayCalculations(index, perimeter_m, perimeter_ft, area_m, area_km, area_acres, area_hectares, area_ft, area_snm, perimeter_yard, area_yard){
	var pitch = ( areacontainer[areacontainer_current]['pitch'] ? areacontainer[areacontainer_current]['pitch'] : 0 );
	var azimuth = ( areacontainer[areacontainer_current]['angle'] ? areacontainer[areacontainer_current]['angle'] : 0 );
	var panelWatts = ( areacontainer[areacontainer_current]['panelWatts'] ? areacontainer[areacontainer_current]['panelWatts'] : 0 );
	var panel_cnt = ( areacontainer[areacontainer_current]['panel_cnt'] ? areacontainer[areacontainer_current]['panel_cnt'] : 0 );
	
	
	var width = ( areacontainer[areacontainer_current]['panelWidth'] ? areacontainer[areacontainer_current]['panelWidth'] : 0 );
	var height = ( areacontainer[areacontainer_current]['panelHeight'] ? areacontainer[areacontainer_current]['panelHeight'] : 0 );
	
	var html = "" +
			"<div class='title'><a href='#' style='width:100%' onclick='setActiveArea("+index+")'>"+areacontainer_labels[index]+"</a></div>" +
			"<div id='overlay"+index+"' class='overlay'>" +
				
				"<div class='content'>" +

				
					"<table>" +
					"<thead><tr><td>Area</td><td>Perimeter</td></tr></thead>" +
					"<tbody>" +
					"<tr><td>"+addCommas(parseFloat(area_ft).toFixed(2))+" feet&sup2;</td><td>"+addCommas(parseFloat(perimeter_ft).toFixed(2))+" feet</td></tr>" +
					"<tr><td>"+addCommas(parseFloat(area_m).toFixed(2))+" m&sup2;</td><td>"+addCommas(parseFloat(perimeter_m).toFixed(2))+" m</td></tr>" +
					
					"</tbody>" +
					"</table>"+
					
					"<div class='button-actions'>" +					
						(readonly ? "" : "<button onclick='return deleteArea("+index+")' >Delete Array</button>") +
						(readonly ? "" : "<button onclick='return deleteLastPoint("+index+");'>Delete Last Point</button>") +
						(readonly ? "" : "<button onclick='return setAreaLabelDialog("+index+")' >Set Label</button>") +
						"<div style='height:40px' class='clear'></div>"+
						'<input type="radio" id="radio1" onclick="hidePins()" name="radio" value="HIDE_PINS" class="ui-helper-hidden-accessible"><label for="radio1" aria-pressed="false" class="ui-button ui-widget ui-state-default ui-button-text-only ui-corner-left" role="button" aria-disabled="false"><span class="ui-button-text">Hide Pins</span></label>' +
						'<input type="radio" id="radio2" onclick="hideLabels()" name="radio" value="HIDE_LABELS" class="ui-helper-hidden-accessible"><label for="radio2" aria-pressed="false" class="ui-button ui-widget ui-state-default ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">Hide Labels</span></label>' +
						'<input type="radio" id="radio3" onclick="hideBoth()" name="radio" value="HIDE_BOTH" class="ui-helper-hidden-accessible"><label for="radio3" aria-pressed="false" class="ui-button ui-widget ui-state-default ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">Hide Both</span></label>' +
						'<input type="radio" id="radio4" onclick="hideNone()" name="radio" value="HIDE_NONE" checked="checked" class="ui-helper-hidden-accessible"><label for="radio4" class="ui-state-active ui-button ui-widget ui-state-default ui-button-text-only ui-corner-right" aria-pressed="true" role="button" aria-disabled="false"><span class="ui-button-text">Hide None</span></label>' +
											
					"</div>" +
				"</div>" +
			"</div>";
	$("#calculations").append(html);
}

function displayCalculationTotals(perimeter_m, perimeter_ft, area_m, area_km, area_acres, area_hectares, area_ft, area_snm, perimeter_yard, area_yard){
		
	var html = "" +
		"<div class='title'><a href='#'>Totals:</a></div>" +
		"<div class='total'>" +
		"<div class='content'>" +
		"<table>" +
		"<thead><tr><td>Area</td><td>Perimeter</td></tr></thead>" +
		"<tbody>" +
		"<tr><td>"+addCommas(parseFloat(area_ft).toFixed(2))+" feet&sup2;</td><td>"+addCommas(parseFloat(perimeter_ft).toFixed(2))+" feet</td></tr>" +
		"<tr><td>"+addCommas(parseFloat(perimeter_m).toFixed(2))+" m</td><td>"+addCommas(parseFloat(area_m).toFixed(2))+" m&sup2;</td><td></td></tr>" +
		"</tbody>" +
		"</table>"+
		"</div>" +
	"</div>";
	$("#totals").append(html);
}


function setAreaLabelDialog(index){
	
	$("#setAreaLabel-dialog #label").val(areacontainer_labels[index]);
	
	$("#setAreaLabel-dialog").dialog({
	      buttons : {
	        "Set" : function() {
	        		        		        	
	        	var label = $("#setAreaLabel-dialog #label").val();
	        	
	        	if(label == ''){
	        		alert('Please input a label');
	        		return;
	        	}
	        	
	        	areacontainer_labels[index] = label
	        	
	        	display();
	        	$(this).dialog("close");
	        },
	        "Cancel" : function() {
	          $(this).dialog("close");
	        }
	      },
			open: function() {
			    $("#setAreaLabel-dialog").keypress(function(e) {
			      if (e.keyCode == $.ui.keyCode.ENTER) {
			        $(this).parent().find("button:eq(0)").trigger("click");
			      }
			    });
			  }
	    });

	    $("#setAreaLabel-dialog").dialog("open");
	    
	    $('.ui-dialog :button').blur();
	    
	return false;
}



function setLineLengthDialog(index, number){
	
	var path = areaPath2[index][number].getPath();
	var origin = path.getAt(0);
	var dest = path.getAt(1);
	var p1 = new LatLon(origin.lat(), origin.lng()); 
	var p2 = new LatLon(dest.lat(), dest.lng()); 
	
	var km = p1.distanceTo(p2);
	
	var html = "<div>"+
	"<b>Current Length:</b><br>"+
	addCommas(parseFloat(km/0.0003048).toFixed(2))+" feet<br>"+
	addCommas(parseFloat(km/0.0009144).toFixed(2))+" yards<br>"+
	addCommas(parseFloat(km/0.001).toFixed(2))+" meters<br>"+
	"</div>";
	
	$("#oldLength").html(html);
	
	
	$("#setLineLength-dialog").dialog({
	      buttons : {
	        "Set" : function() {
	        		        		        	
	        	var length = $("#setLineLength-dialog #length").val();
	        	var units = $("#setLineLength-dialog #units").val();
	        	
	        	if(length == ''){
	        		alert('Please input a length');
	        		return;
	        	}
	        	setLineLength(index, number, length, units);	        	
	        	display();
	        	$(this).dialog("close");
	        },
	        "Cancel" : function() {
	          $(this).dialog("close");
	        }
	      },
		open: function() {
		    $("#setLineLength-dialog").keypress(function(e) {
		      if (e.keyCode == $.ui.keyCode.ENTER) {
		        $(this).parent().find("button:eq(0)").trigger("click");
		      }
		    });
		  }

	    });

	    $("#setLineLength-dialog").dialog("open");
	    
	    $('.ui-dialog :button').blur();
	    
	return false;
}


function setLineLength(index, number, length, units){
		
	var path = areaPath2[index][number].getPath();
	
	var origin = path.getAt(0);
	var dest = path.getAt(1);
	
	var p1 = new LatLon(origin.lat(), origin.lng()); 
	var p2 = new LatLon(dest.lat(), dest.lng()); 
	var bearing = p1.bearingTo(p2); 
	
	var conv = 1;
	if(units=='meters')
		conv = '.001';
	if(units=='feet')
		conv = '0.0003048';
	if(units=='yards')
		conv = '0.0009144';
	if(units=='kilometers')
		conv = 1;
	if(units=='miles')
		conv = '1.60934';
	
	var distance = length * conv;
	
	var newdest = p1.destinationPoint(bearing, distance);
	
	var newdestLatLng = new google.maps.LatLng(newdest.lat(), newdest.lon());	
	
	
	if(areacontainer[index][number+1] == undefined){
		var next = 0;
	}else{
		var next = number+1;
	}
	
	areacontainer[index][next] = newdestLatLng;
	
	/*
	console.log(origin);
	console.log(dest);
	console.log(distance);
	console.log(bearing);
	console.log(newdestLatLng);
	console.log(areacontainer[index][next]);
	*/
	
	return;
	
}


function deleteArea(index){
	
	$("#delete-dialog").dialog({
	      buttons : {
	        "Confirm" : function() {
	        	areacontainer.splice(index,1);
	        	areacontainer_labels.splice(index,1);
	        	areacontainer_types.splice(index,1);
	        	areacontainer_toggle.splice(index,1);

				var boxes = boxSet[index];
				//Delete old boxes.
				if ( boxes !== null && boxes !== undefined )
				{
					for ( var i = 0; i < boxes.length; ++i) {
					  boxes[i].setMap(null);
					  delete boxes[i];
					}
				}

				boxSet.splice(index,1);
	        	if(areacontainer.length == 0){
	        		areacontainer_current = null;
	        	}else{
	        		areacontainer_current = areacontainer.length - 1;
	        	}
	        	display();
	        	$(this).dialog("close");
				
				calculateSystemSize();
	        },
	        "Cancel" : function() {
	          $(this).dialog("close");
	        }
	      }
	    });

	    $("#delete-dialog").dialog("open");
	    
	    $('.ui-dialog :button').blur();
	    
	return false;
}

function setActiveArea(index){
	areacontainer_current = index;
	
	if ( areacontainer.length > 0 )
	{
		var polygonX = areacontainer[areacontainer_current];

		document.getElementById('angelPanels').value = polygonX['angle'];
		document.getElementById('roofPitch').value   = polygonX['pitch'];

		document.getElementById('panelWidth').value = polygonX['panelWidth'];
		document.getElementById('panelHeight').value = polygonX['panelHeight'];

		document.getElementById('panelWatts').value = polygonX['panelWatts'];
			
		display();
				
		
	}
	return true;
}

function searchAddress(){
	$('#loading').show();	
	var params = "";
	params += $("#search-form").serialize();	
	if($('#address').val() != ''){		
		var address = $('#address').val();		
		geocoder.geocode( { 'address': address}, function(results, status) {
			var location = '';		
			  if(status == google.maps.GeocoderStatus.OK) {			
				location = results[0].geometry.location;				
				map.setCenter(location);
				
				var resultBounds = new google.maps.LatLngBounds(
				    results[0].geometry.viewport.getSouthWest(), 
				    results[0].geometry.viewport.getNorthEast()
				);

				map.fitBounds(resultBounds);

				placeSearchMarker(location);

				map.setZoom(20);				 
			  }
			  $('#loading').hide();
		});					
	} 		
	return false;
}

function saveMapDialog(){
	
	$("#save-dialog").dialog({
		  width:400,
	      buttons : {
	        "Send" : function() {
	        	if($('#save-form #name').val() == '' || $('#save-form #email').val() == ''){
	        		alert('Please fill out all required fields');
	        		return;
	        	}
	        	saveMap();
	        	$(this).dialog("close");
	        },
	        "Cancel" : function() {
	          $(this).dialog("close");
	        }
	      },
			open: function() {
			    $("#save-dialog").keypress(function(e) {
			      if (e.keyCode == $.ui.keyCode.ENTER) {
			        $(this).parent().find("button:eq(0)").trigger("click");
			      }
			    });
			  }
	    });

	    $("#save-dialog").dialog("open");
	    
	    $('.ui-dialog :button').blur();
	    
	    return false;
}

function saveMap(){
	
	if(areacontainer.length > 0){
		for(var i=0; i<areacontainer.length; i++){
			if(areacontainer[i].length > 0){
				var points = new Array(0);
				for(var j=0; j<areacontainer[i].length; j++){
					var point = areacontainer[i][j].lat()+','+areacontainer[i][j].lng();
					points.push(point);			
				}
				var temp = points.join('~');
				$('#save-form #hidden').append("<input type='hidden' name='overlay[]' value='"+temp+"' />");
				$('#save-form #hidden').append("<input type='hidden' name='label[]' value='"+areacontainer_labels[i]+"' />");
				$('#save-form #hidden').append("<input type='hidden' name='type[]' value='"+areacontainer_types[i]+"' />");
			}
		}
		/*
		for(var i=0; i<areacontainer_labels.length; i++){
			$('#save-form #hidden').append("<input type='hidden' name='label[]' value='"+areacontainer_labels[i]+"' />");
		}
		for(var i=0; i<areacontainer_types.length; i++){
			$('#save-form #hidden').append("<input type='hidden' name='type[]' value='"+areacontainer_types[i]+"' />");
		}
		*/
		var params = $('#save-form').serialize();
		var msg = eval($.ajax({async:false, url:'ajax/save.php?', cache:false, type:'POST', data: params}).responseText);
		$('#save-form #hidden').html('');
	}else{
		var msg = Array(0);
		msg[0] = false;
		msg[1] = "Your map has no overlays. Please add at least one."
	}
	
	alert(msg[1]);
	
	return false;
}


function shapeDialog(){
	
	$("#shape-dialog").dialog({
		 width: 300,
	      buttons : {
	        "Add Shape" : function() {
	        	var type = $("#type").val();
	        	if(type=='rectangle'){
	        		var units = $("#rectangle #units").val();
		        	var length1 = $("#rectangle #side1").val();
		        	var length2 = $("#rectangle #side2").val();
		        	if(length1 == '' || length2 == ''){
		        		alert('Please fill out all fields');
		        		return;
		        	}		        		
		        	addRect(units, length1, length2);
	        	}
	        	else if(type=='triangle'){
	        		var units = $("#triangle #units").val();
		        	var length1 = $("#triangle #side1").val();
		        	var length2 = $("#triangle #side2").val();
		        	var angle1 = $("#triangle #angle1").val();
		        	if(length1 == '' || length2 == '' || angle1 == ''){
		        		alert('Please fill out all fields');
		        		return;
		        	}
		        	if(parseFloat(angle1) > 90){
		        		alert('Acute angle must be less than 90 degrees');
		        		return;
		        	}
		        	addTri(units, length1, length2, angle1);
	        	}
	        	else if(type=='circle'){
	        		var units = $("#circle #units").val();
		        	var length1 = $("#circle #side1").val();
		        	if(length1 == ''){
		        		alert('Please fill out all fields');
		        		return;
		        	}
		        	addCirc(units, length1);
	        	}
	        	else if(type=='semicircle'){
	        		var units = $("#semicircle #units").val();
		        	var length1 = $("#semicircle #side1").val();
		        	if(length1 == ''){
		        		alert('Please fill out all fields');
		        		return;
		        	}
		        	addSemiCirc(units, length1);
	        	}
	        	        	
	        	
	        	$(this).dialog("close");
	        },
	        "Cancel" : function() {
	          $(this).dialog("close");
	        }
	      },
			open: function() {
			    $("#shape-dialog").keypress(function(e) {
			      if (e.keyCode == $.ui.keyCode.ENTER) {
			        $(this).parent().find("button:eq(0)").trigger("click");
			      }
			    });
			  }
	    });

	    $("#shape-dialog").dialog("open");
	    
	    $('.ui-dialog :button').blur();
	    
	    return false;
}


function addRect(units, length1, length2){
	createNewArea();
	var conv = 1;
	if(units=='meters')
		conv = '.001';
	if(units=='feet')
		conv = '0.0003048';
	if(units=='yards')
		conv = '0.0009144';
	if(units=='kilometers')
		conv = 1;
	if(units=='miles')
		conv = '1.60934';
	var length1_km = length1 * conv;
	var length2_km = length2 * conv;
	var point1 = map.getCenter();
	var p1 = new LatLon(point1.lat(), point1.lng());                                                      
	var p2 = p1.destinationPoint(0,length1_km);          // in km
	var p3 = p2.destinationPoint(90,length2_km);
	var p4 = p3.destinationPoint(180,length1_km);		
	
	var point2 = new google.maps.LatLng(p2.lat(), p2.lon());
	var point3 = new google.maps.LatLng(p3.lat(), p3.lon());
	var point4 = new google.maps.LatLng(p4.lat(), p4.lon());
	areacontainer[areacontainer_current].push(point1);
	areacontainer[areacontainer_current].push(point2);
	areacontainer[areacontainer_current].push(point3);
	areacontainer[areacontainer_current].push(point4);
	display();
}

function addTri(units, length1, length2, angle1){
	createNewArea();
	var conv = 1;
	if(units=='meters')
		conv = '.001';
	if(units=='feet')
		conv = '0.0003048';
	if(units=='yards')
		conv = '0.0009144';
	if(units=='kilometers')
		conv = 1;
	if(units=='miles')
		conv = '1.60934';
	var length1_km = length1 * conv;
	var length2_km = length2 * conv;
	var point1 = map.getCenter();
	var p1 = new LatLon(point1.lat(), point1.lng());
	var p2 = p1.destinationPoint(90,length1_km);
	var p3 = p1.destinationPoint(90-parseFloat(angle1),length2_km);
	var point2 = new google.maps.LatLng(p2.lat(), p2.lon());
	var point3 = new google.maps.LatLng(p3.lat(), p3.lon());
	areacontainer[areacontainer_current].push(point1);
	areacontainer[areacontainer_current].push(point2);
	areacontainer[areacontainer_current].push(point3);
	display();
}

function addCirc(units, length1){
	createNewArea();
	var conv = 1;
	if(units=='meters')
		conv = '.001';
	if(units=='feet')
		conv = '0.0003048';
	if(units=='yards')
		conv = '0.0009144';
	if(units=='kilometers')
		conv = 1;
	if(units=='miles')
		conv = '1.60934';
	var length1_km = length1 * conv;
	var radius = length1_km * .000157;
	var d = radius;
	var point1 = map.getCenter();
	
	with(Math){
		var lat1 = (PI/180)* point1.lat(); // radians
		var lng1 = (PI/180)* point1.lng(); // radians	
	
		var circlePoints = Array();
		var bearing = 0;
		
		for (var a = bearing-360 ; a < bearing+1 ; a=a+2 ) {
			var tc = (PI/180)*a;
			var y = asin(sin(lat1)*cos(d)+cos(lat1)*sin(d)*cos(tc));
			var dlng = atan2(sin(tc)*sin(d)*cos(lat1),cos(d)-sin(lat1)*sin(y));
			var x = ((lng1-dlng+PI) % (2*PI)) - PI ; // MOD function
			var point = new google.maps.LatLng(parseFloat(y*(180/PI)),parseFloat(x*(180/PI)));
			circlePoints.push(point);
		}
	}
	
	areacontainer[areacontainer_current] = circlePoints;

	display();
	
}

function addSemiCirc(units, length1){
	createNewArea();
	var conv = 1;
	if(units=='meters')
		conv = '.001';
	if(units=='feet')
		conv = '0.0003048';
	if(units=='yards')
		conv = '0.0009144';
	if(units=='kilometers')
		conv = 1;
	if(units=='miles')
		conv = '1.60934';
	var length1_km = length1 * conv;
	var radius = length1_km * .000157;
	var d = radius;
	var point1 = map.getCenter();
	
	with(Math){
		var lat1 = (PI/180)* point1.lat(); // radians
		var lng1 = (PI/180)* point1.lng(); // radians	
	
		var circlePoints = Array();
		var bearing = 0;
		
		for (var a = bearing-180 ; a < bearing+1 ; a=a+2 ) {
			var tc = (PI/180)*a;
			var y = asin(sin(lat1)*cos(d)+cos(lat1)*sin(d)*cos(tc));
			var dlng = atan2(sin(tc)*sin(d)*cos(lat1),cos(d)-sin(lat1)*sin(y));
			var x = ((lng1-dlng+PI) % (2*PI)) - PI ; // MOD function
			var point = new google.maps.LatLng(parseFloat(y*(180/PI)),parseFloat(x*(180/PI)));
			circlePoints.push(point);
		}
	}
	
	areacontainer[areacontainer_current] = circlePoints;

	display();
	
}


function setReadonly(id){
	
	$("#search-form").hide();
	//google.maps.event.clearInstanceListeners(map);

	var params = 'id='+id;
	$.ajax({async:true, url:'ajax/populate.php?', dataType: 'json', cache:false, type:'POST', data: params, success: function(data){ 
		var result = convertToPoints(data.coordinates); 
		areacontainer = result; 
		areacontainer_current = 0;
		areacontainer_labels = data.labels;
		areacontainer_types = data.types;
		
		for(var i = 0; i<areacontainer.length; i++){
			areacontainer_toggle[i] = 'HIDE_NONE';
		}
		
		display(true);
		
		var bounds = new google.maps.LatLngBounds(); 
		for(var i=0; i<areaMarkers.length; i++){
			bounds.extend(areaMarkers[i].getPosition());
		}
		map.fitBounds(bounds);

		display(true);
		
		}
	});
	
	
}


function getPolygonCenter(index){
	
	var x_total = 0;
	var y_total = 0;

	
	for(var i=0; i<areacontainer[index].length; i++){
        		     		
		var tempx = overlay.getProjection().fromLatLngToContainerPixel(areacontainer[index][i]).x;
		x_total = x_total + tempx;
		var tempy = overlay.getProjection().fromLatLngToContainerPixel(areacontainer[index][i]).y;
		y_total = y_total + tempy;
				
	}
	
	x_total = x_total / areacontainer[index].length;
	y_total = y_total / areacontainer[index].length;
	
	var tempPoint = new google.maps.Point(x_total, y_total);
	var latlng = overlay.getProjection().fromContainerPixelToLatLng(tempPoint);
		
	return latlng;
	
}


function convertToPoints(array){
	
	for(var i=0; i<array.length; i++){
		for(var j=0; j<array[i].length; j++){
			var temp = array[i][j].split(',');
			var lat = temp[0];
			var lng = temp[1];
			array[i][j] = new google.maps.LatLng(lat, lng);
		}
	}
	
	return array;
}






function addSelectedPanel(panel, section) {
    null == panel || -1 == selectedPanels.indexOf(panel) ? (null != panel && panel.setOptions({
        fillColor: "red"
    }), selectedPanels.push(panel), null != section && setSelectedSection(section)) : deselectPanel(panel)
}

function deletePanel(p) {
    var index = selectedSection.boxes.indexOf(p); - 1 !== index && selectedSection.boxes.splice(index, 1), p.setMap(null), delete p;
    let pIndex = selectedPanels.indexOf(p);
    selectedPanels.splice(pIndex, 1), layoutChanged = !0, -1 === selectedSection.deletedPanels.indexOf(p.panelIndex) && selectedSection.deletedPanels.push(p.panelIndex)
}

function deselectPanel(panel, section) {
    if (null == panel || -1 === selectedPanels.indexOf(panel)) return;
    panel.setOptions({
        fillColor: "blue"
    });
    let index = selectedPanels.indexOf(panel); - 1 !== index && selectedPanels.splice(index, 1), null != section && setSelectedSection(section)
}

function setSelectedPanel(panel, section) {
    null != panel && -1 != selectedPanels.indexOf(panel) || (null != panel && panel.setOptions({
        fillColor: "red"
    }), selectedPanels.forEach(p => p.setOptions({
        fillColor: "blue"
    })), selectedPanels = null === panel ? [] : [panel], null != section && setSelectedSection(section))
}

function placeAnchor(location, index){
	
	//var icon = "img/mini-marker.png";
	var icon = new google.maps.MarkerImage("img/mini-marker.png",
			new google.maps.Size(16, 16),
			new google.maps.Point(0,0),
			new google.maps.Point(6, 6)
		);
	
	if(readonly){
		draggable = false;
	}else{
		draggable = false;//true;
	}
	
	var marker = new google.maps.Marker({
        position: location,
        map: map,
        //shadow: shadow,
        icon: icon,
        draggable: draggable,
        oldposition: location,
        index: index
    });
	
	var f = function (index) {
        return function () {
            //areacontainer[index][number] = marker.position;
            //areacontainer_current = index;
        	//var oldlat = marker.oldposition.lat();
        	//var newlat = marker.position.lat();
        	//console.log(oldlat);
        	//console.log(newlat);
        	var oldx = overlay.getProjection().fromLatLngToContainerPixel(marker.oldposition).x;
        	var newx = overlay.getProjection().fromLatLngToContainerPixel(marker.position).x;
        	var diffx = newx - oldx;
        	
        	var oldy = overlay.getProjection().fromLatLngToContainerPixel(marker.oldposition).y;
        	var newy = overlay.getProjection().fromLatLngToContainerPixel(marker.position).y;
        	var diffy = newy - oldy;
        	//overlay.getProjection().fromContainerPixelToLatLng()
        	for(var i =0; i<areacontainer[index].length; i++){
        		
        		//Point(x:number, y:number)
        		
        		var tempx = overlay.getProjection().fromLatLngToContainerPixel(areacontainer[index][i]).x;
        		tempx = tempx + diffx;
        		var tempy = overlay.getProjection().fromLatLngToContainerPixel(areacontainer[index][i]).y;
        		tempy = tempy + diffy;
        		
        		var tempPoint = new google.maps.Point(tempx, tempy);
        		areacontainer[index][i] = overlay.getProjection().fromContainerPixelToLatLng(tempPoint);
        	}
        	areacontainer_current = index;        	
            display();
            $(".context-menu").css('visibility','hidden');
        }
    };
    
    
    var f2 = function (index, marker ) {
		selectedBox = marker;
        return function () {
        	areacontainer_current = index;
            display();
            $(".context-menu").css('visibility','hidden');
        }
    };
    
    if(!(readonly)){
    	google.maps.event.addListener(marker, 'dragend', f(index));
    	//google.maps.event.addListener(marker, 'click', f2(index, location, 10));
    	
    	google.maps.event.addListener(marker, 'rightclick', function(event){
        	polygonMenu(this,event);	            	
			selectedBox = marker;
        });
    	
    }
    //ccc
    google.maps.event.addListener(marker, 'click', f2(index, marker));
    
	return marker;
}



function placeRotator(location, index){
		
	var icon = "img/rotate.png";
	
	if(readonly){
		draggable = false;
	}else{
		draggable = true;
	}
	
	var anchor = location;
	
	var polygon_top = polygon[index].getBounds().getNorthEast().lat();
	var p1 = new LatLon(polygon_top,location.lng());
	var p2 = new LatLon(location.lat(), location.lng());
	var result = p1.midpointTo(p2);
	var location = new google.maps.LatLng(result.lat(), result.lon());
		
	var marker = new google.maps.Marker({
        position: location,
        map: map,
        icon: icon,
        draggable: draggable,
        oldposition: location,
        index: index,
        anchor: anchor
    });
	
	var line = new google.maps.Polyline({
        path: [marker.getPosition(), anchor],
        map: map,
        strokeColor: '#ffffff',
        strokeWeight: 1
      });
	
	rotatorLines.push(line);
    
	marker.position_changed = function() {
		update_rotator_line(line, this.get('position'), this.anchor);
      }
    
    var f2 = function (index) {
        return function () {
        	areacontainer_current = index;
            display();
            $(".context-menu").css('visibility','hidden');
        }
    };
    
    if(!(readonly)){
    	google.maps.event.addListener(marker, 'dragend', function(event){
    		dragRotation(this,event);
    	});
    	//google.maps.event.addListener(marker, 'click', f2(index, location, 10));
    	
    	google.maps.event.addListener(marker, 'rightclick', function(event){
//        	polygonMenu(this,event);	            	
        });
    	google.maps.event.addListener(marker, 'click', f2(index));
		
    }
    
	return marker;
}


function update_rotator_line(line, position1, position2){
    // update the line
    line.getPath().setAt(0, position1);
    line.getPath().setAt(1, position2);
  }


function dragRotation(marker, event){
	
	areacontainer_current = marker.index;
	//console.log(marker.anchor);
	
	var initialPoint = marker.anchor;//areaAnchors[marker.index].position;
	var p1 = new LatLon(initialPoint.lat(),initialPoint.lng());
	var p2 = new LatLon(event.latLng.lat(),event.latLng.lng());
	
	var bearing = p1.finalBearingTo(p2);
	
	rotatePoly(marker.index, initialPoint, bearing)
	//renderPanels(map, null);

	index = marker.index;
	
/*	var polygon_top = polygon[index].getBounds().getNorthEast().lat();
	var po1 = new LatLon(polygon_top,location.lng());
	var po2 = new LatLon(location.lat(), location.lng());
	var result = po1.midpointTo(po2);*/

    var bounds = new google.maps.LatLngBounds()
    var location = initialPoint;// polygonCenter(polygon); //.getPolygonCenter();//getPath().forEach(function(element,index){bounds.extend(element)})
	
//	var location = bounds.getCenter();
	//new google.maps.LatLng(result.lat(), result.lon());

	var overlay = areacontainer[marker.index];
	var boxes = boxSet[marker.index];
	for ( var i = 0; i < boxes.length; ++i )
	{
		rotatePolyBox(boxes[i], location, bearing);
	}
	
	$(".context-menu").css('visibility','hidden');
}


function rotatePoly(index, pivotPoint, angle) {
	var newPath = [];
	var path = areacontainer[index];
	for (var p = 0 ; p < path.length ; p++) {
		var pt = transposePoint(path[p],pivotPoint,angle);
		newPath.push(pt);
	}
	areacontainer[index] = newPath;
	display();
	
	//renderPanels(map, null);
}


function deselectAll()
{
	for ( var i = 0;i < selectedBoxList.length; ++i )
		selectedBoxList[i].fillColor = 'white';
	selectedBoxList = [];
	selectedBox = null;
}

function rotatePolyBox(box, pivotPoint, angle) {
	var newPath = [];
	var path = box.getPath();
	for (var p = 0 ; p < path.length ; p++) {
		var pt = transposePoint(path.b[p],pivotPoint,angle);
		newPath.push(pt);
	}
	box.setPath( newPath);
	
	//renderPanels(map, null);
}

  
function transposePoint(point,pivotPoint,angle) {
	
	var tmpXY = overlay.getProjection().fromLatLngToContainerPixel(pivotPoint);
	var centerX = parseFloat(tmpXY.x); 
	var centerY = parseFloat(tmpXY.y); 
	
	var tmpXY = overlay.getProjection().fromLatLngToContainerPixel(point);
	var theX = parseFloat(tmpXY.x);
	var theY = parseFloat(tmpXY.y);
	
	angle = parseFloat(angle);
	
	with(Math){
		if (centerX == 0 && centerY == 0) {
		    var newX = theX * cos(angle.toRad()) - sin(angle.toRad()) * theY;
		    var newY = theX * sin(angle.toRad()) + cos(angle.toRad()) * theY;
		} else {
		    var newX = (theX - centerX) * cos(angle.toRad()) - (theY - centerY) * sin(angle.toRad()) + centerX;
		    var newY = (theX - centerX) * sin(angle.toRad()) + (theY - centerY) * cos(angle.toRad()) + centerY;
		}
	}
	
	var tempPoint = new google.maps.Point(newX, newY);
	var pt = overlay.getProjection().fromContainerPixelToLatLng(tempPoint); 
	return pt;
	
}


function transposePoint2(point,pivotPoint,angle) {
	
	var tmpXY = pivotPoint;
	var centerX = parseFloat(tmpXY.x); 
	var centerY = parseFloat(tmpXY.y); 
	
	var tmpXY = point;
	var theX = parseFloat(tmpXY.x);
	var theY = parseFloat(tmpXY.y);
	
	angle = parseFloat(angle);
	
	with(Math){
		if (centerX == 0 && centerY == 0) {
		    var newX = theX * cos(angle.toRad()) - sin(angle.toRad()) * theY;
		    var newY = theX * sin(angle.toRad()) + cos(angle.toRad()) * theY;
		} else {
		    var newX = (theX - centerX) * cos(angle.toRad()) - (theY - centerY) * sin(angle.toRad()) + centerX;
		    var newY = (theX - centerX) * sin(angle.toRad()) + (theY - centerY) * cos(angle.toRad()) + centerY;
		}
	}
	
	var tempPoint = new google.maps.Point(newX, newY);
	return tempPoint;
	
}

function instructionsDialog(){
	
	$("#instructions-dialog").dialog({
		  width:600,
	      buttons : {	        
	        "Close" : function() {
	          $(this).dialog("close");
	        }
	      }
	    });

	    $("#instructions-dialog").dialog("open");
	    
	    $('.ui-dialog :button').blur();
	    
	    //$(window).trigger('resize');
	    
	    return false;
}



function fileDialog(){
	
	$("#file-dialog").dialog({
		  width:400,
	      buttons : {	        
	        "Close" : function() {
	          $(this).dialog("close");
	        }
	      }
	    });

	    $("#file-dialog").dialog("open");

	    $('.ui-dialog :button').blur();

	    return false;
}



function genKML(){
	
	if(areacontainer.length > 0){
		for(var i=0; i<areacontainer.length; i++){
			if(areacontainer[i].length > 0){
				var points = new Array(0);
				for(var j=0; j<areacontainer[i].length; j++){
					var point = areacontainer[i][j].lat()+','+areacontainer[i][j].lng();
					points.push(point);			
				}
				var temp = points.join('~');
				$('#export-form').append("<input type='hidden' name='overlay[]' value='"+temp+"' />");
				$('#export-form').append("<input type='hidden' name='label[]' value='"+areacontainer_labels[i]+"' />");
				$('#export-form').append("<input type='hidden' name='type[]' value='"+areacontainer_types[i]+"' />");
			}
		}
		
		//var params = $('#save-form').serialize();
		//var msg = eval($.ajax({async:false, url:'ajax/gen_kml.php?', cache:false, type:'POST', data: params}).responseText);
		//window.location = 'ajax/gen_kml.php?'+params;
		$('#export-form').submit();
		$('#export-form').html('');
	}else{
		var msg = Array(0);
		msg[0] = false;
		msg[1] = "Your design has no arrays. Please add at least one.";
		alert(msg[1]);
	}
			
	return false;
}


function placeSearchMarker(location) {

	deleteSearchMarker();
    
	var icon = new google.maps.MarkerImage('img/pin-red.png',
		new google.maps.Size(15, 27),
		new google.maps.Point(0,0),
		new google.maps.Point(7, 27));
	
	var shadow = new google.maps.MarkerImage('img/pin-shadow.png',
    	new google.maps.Size(25, 25),
    	new google.maps.Point(0,0),
    	new google.maps.Point(4, 33));
	
	var marker = new google.maps.Marker({
        position: location,
        map: map,
        shadow: shadow,
        icon: icon,
        draggable: false

    }); 
    
    google.maps.event.addListener(marker, 'rightclick', function(event){
		searchMarkerMenu(this, event);
	});

	marker.setOptions({
    	draggable: true
    });

    /*
    if(!(readonly)){
    		
    	google.maps.event.addListener(marker, 'dragend', f(index, number));
    	google.maps.event.addListener(marker, 'click', f2(index, number));
	
    
    	google.maps.event.addListener(marker, 'rightclick', function(event){
    		markerMenu(this, event);
    	});
    
    }
    */
    
    search_marker = marker;


}

function toggleRotators( )
{
	for ( var i = 0; i < areaRotators.length; ++i )
	{
		if ( areaRotators[i].getMap() != null ) {
			areaRotators[i].setMap(null);
			rotatorLines[i].setMap(null);
		}
		else
		{
			areaRotators[i].setMap(map);
			rotatorLines[i].setMap(map);
		}
	}
}

function deleteSearchMarker(){
	if(search_marker != null){
		search_marker.setMap(null);
		search_marker = null;
	}
}
		var fenceTypes = [
			{"type": "vinyl", loadedCost: 110, "label": "Vinyl", "img": "vinyl.png"}, 
			{"type": "wood", loadedCost: 120, "label": "Wood", "img": "wood.png"}, 
			{"type": "chink", loadedCost: 310, "label": "Chain Link", "img": "chainlink.png"}, 
			{"type": "metal", loadedCost: 210, "label": "Metal", "img": "metal.png"} ];
			
		var gateTypes = [{"uuid": "012010120", "label": "Chain Link 5' Gate", "img": "https://cdn2.bigcommerce.com/server3800/28117/products/1281/images/2720/DogAccessGatenotext__83058.1578336554.1280.1280.jpg?c=2"} ];
	
		fenceTypes = [
			{"uuid":"03cb6b933e9440a9903f52c86779e48e","name":"Alum gate","barcode":"","productLineDesc":"","units":"0","priceLevel":"0","category":"Gate","model":"","make":"US Door \u0026 Fence","taxType":"all","vendorName":"","currentCount":0,"cost":0.00,"retailPrice":0.00,"notExhaustable":false,"customField1":"","customField2":"","customField4":"","customField5":"","uuidLocation":"","descript":"","enabled":true,"installationCost":0.00,"width":0.0000,"height":0.0000,"weight":0.0000,"mapPlaceable":false,"territory":"","createUserId":"jdubin","updateUserId":"jdubin","createUserUuid":"71590418a3cc43b0b4fc29f5e86d6868","updateUserUuid":"71590418a3cc43b0b4fc29f5e86d6868","createTime":"Nov 19, 2020 4:53:09 PM","updateTime":"Nov 19, 2020 4:53:09 PM"},
			{"uuid":"2a4b3dcc01f6499dbf42af633a37cd8c","name":"Vinyl","barcode":" ","productLineDesc":" ","units":"0","priceLevel":"0","category":"Fence","model":"","make":"Weatherables","taxType":"all","vendorName":"","currentCount":0,"cost":110.00,"retailPrice":265.00,"notExhaustable":false,"customField1":" ","customField2":"","customField4":"","customField5":"https://images.homedepot-static.com/productImages/6b0b0f57-3ae9-4cc8-ba93-d100059cb3c0/svn/white-veranda-vinyl-fence-panels-73014216-64_400_compressed.jpg","uuidLocation":"","descript":" ","enabled":true,"installationCost":0.00,"width":0.0000,"height":0.0000,"weight":0.0000,"mapPlaceable":true,"territory":"","createUserId":"jdubin","updateUserId":"jdubin","createUserUuid":"71590418a3cc43b0b4fc29f5e86d6868","updateUserUuid":"71590418a3cc43b0b4fc29f5e86d6868","createTime":"Sep 25, 2020 8:40:41 AM","updateTime":"Sep 27, 2020 12:36:24 PM"},
			{"uuid":"33cbae409aa84d2abc0713c700cab490","name":"Wood 3.5 ft. H W x 6 ft. H Red Cedar w/Lattice","barcode":" ","productLineDesc":" ","units":"0","priceLevel":"0","category":"Gate","model":"","make":"Signature Development","taxType":"all","vendorName":"","currentCount":0,"cost":160.00,"retailPrice":275.00,"notExhaustable":false,"customField1":" ","customField2":"","customField4":"","customField5":"https://images.homedepot-static.com/productImages/040f9d3e-85b8-4768-9957-476200a41dd9/svn/signature-development-wood-fence-gates-42x68-5x1-5dgat-64_1000.jpg","uuidLocation":"","descript":" ","enabled":true,"installationCost":0.00,"width":0.0000,"height":0.0000,"weight":0.0000,"mapPlaceable":true,"territory":"","createUserId":"jdubin","updateUserId":"jdubin","createUserUuid":"71590418a3cc43b0b4fc29f5e86d6868","updateUserUuid":"71590418a3cc43b0b4fc29f5e86d6868","createTime":"Sep 25, 2020 9:23:43 AM","updateTime":"Sep 27, 2020 8:33:13 AM"},
			{"uuid":"34e7049869e347e2a7a15d000fed4435","name":"Aluminum ","barcode":" ","productLineDesc":" ","units":"0","priceLevel":"0","category":"Fence","model":"","make":"US Door \u0026 Fence","taxType":"all","vendorName":"","currentCount":0,"cost":66.00,"retailPrice":163.00,"notExhaustable":false,"customField1":" ","customField2":"","customField4":"","customField5":"https://images.homedepot-static.com/productImages/31708b4e-584d-44e7-b22f-927d28f16979/svn/black-us-door-fence-metal-fence-panels-f2ghds93x58us-64_1000.jpg","uuidLocation":"","descript":" ","enabled":true,"installationCost":0.00,"width":0.0000,"height":0.0000,"weight":0.0000,"mapPlaceable":true,"territory":"","createUserId":"jdubin","updateUserId":"jdubin","createUserUuid":"71590418a3cc43b0b4fc29f5e86d6868","updateUserUuid":"71590418a3cc43b0b4fc29f5e86d6868","createTime":"Sep 25, 2020 8:47:33 AM","updateTime":"Sep 27, 2020 12:36:50 PM"},
			{"uuid":"4ee7be97a30e461ab3fc69f2c9bc9917","name":"Wood","barcode":" ","productLineDesc":" ","units":"0","priceLevel":"0","category":"Fence","model":"","make":"","taxType":"all","vendorName":"","currentCount":0,"cost":12.00,"retailPrice":28.00,"notExhaustable":false,"customField1":" ","customField2":"","customField4":"","customField5":"https://images.homedepot-static.com/productImages/7b5043ef-4074-4987-9192-c4aa301483de/svn/wood-fence-panels-07635-64_1000.jpg","uuidLocation":"","descript":" ","enabled":true,"installationCost":0.00,"width":0.0000,"height":0.0000,"weight":0.0000,"mapPlaceable":true,"territory":"","createUserId":"jdubin","updateUserId":"jdubin","createUserUuid":"71590418a3cc43b0b4fc29f5e86d6868","updateUserUuid":"71590418a3cc43b0b4fc29f5e86d6868","createTime":"Feb 6, 2020 11:56:41 AM","updateTime":"Sep 27, 2020 12:36:33 PM"},
			{"uuid":"5539236986094770b606ae4c91f78d1b","name":"Chain Link","barcode":" ","productLineDesc":" ","units":"0","priceLevel":"0","category":"Fence","model":"","make":"","taxType":"all","vendorName":"","currentCount":0,"cost":8.00,"retailPrice":17.00,"notExhaustable":false,"customField1":" ","customField2":"","customField4":"","customField5":"https://images.homedepot-static.com/productImages/3989134f-07fc-4ed1-908f-338c6c77ef37/svn/everbilt-chain-link-fence-gates-3283adj48eb-64_1000.jpg","uuidLocation":"","descript":" ","enabled":true,"loadedCost":10.00,"installationCost":2.00,"width":0.0000,"height":0.0000,"weight":0.0000,"mapPlaceable":true,"territory":"","createUserId":"jdubin","updateUserId":"jdubin","createUserUuid":"71590418a3cc43b0b4fc29f5e86d6868","updateUserUuid":"71590418a3cc43b0b4fc29f5e86d6868","createTime":"Sep 25, 2020 9:33:07 AM","updateTime":"Sep 27, 2020 12:37:03 PM"},
			{"uuid":"770495095b624afe8ed683b92bf3e988","name":"3-1/2 ft. W x 6 ft. H White Vinyl Lewiston Lattice Top Fence Gate","barcode":" ","productLineDesc":" ","units":"0","priceLevel":"0","category":"Gate","model":"","make":"","taxType":"all","vendorName":"","currentCount":0,"cost":188.18,"retailPrice":275.00,"notExhaustable":false,"customField1":" ","customField2":"","customField4":"","customField5":"https://images.homedepot-static.com/productImages/545dd536-c0fd-4868-88d2-dc0d30707087/svn/white-veranda-vinyl-fence-gates-181972-64_1000.jpg","uuidLocation":"","descript":" ","enabled":true,"installationCost":0.00,"width":0.0000,"height":0.0000,"weight":0.0000,"mapPlaceable":true,"territory":"","createUserId":"jdubin","updateUserId":"jdubin","createUserUuid":"71590418a3cc43b0b4fc29f5e86d6868","updateUserUuid":"71590418a3cc43b0b4fc29f5e86d6868","createTime":"Sep 25, 2020 9:39:09 AM","updateTime":"Sep 27, 2020 8:37:16 AM"},{"uuid":"cb6d2fdbde6741dda82e998cb54f6e0b","name":"45 in. x 68 in. Diamond Tipped Gate Door with Arched External Rail for 48 in. Openings (Hardware included)","barcode":" ","productLineDesc":" ","units":"0","priceLevel":"0","category":"Gate","model":"","make":"NUVO","taxType":"all","vendorName":"","currentCount":0,"cost":239.89,"retailPrice":400.00,"notExhaustable":false,"customField1":" ","customField2":"","customField4":"","customField5":"https://images.homedepot-static.com/productImages/b68807c6-d502-47f3-8cbc-ccdce405f9cd/svn/nuvo-iron-metal-fence-gates-dgi0141-64_1000.jpg","uuidLocation":"","descript":" ","enabled":true,"installationCost":0.00,"width":0.0000,"height":0.0000,"weight":0.0000,"mapPlaceable":true,"territory":"","createUserId":"jdubin","updateUserId":"jdubin","createUserUuid":"71590418a3cc43b0b4fc29f5e86d6868","updateUserUuid":"71590418a3cc43b0b4fc29f5e86d6868","createTime":"Sep 25, 2020 9:00:55 AM","updateTime":"Sep 27, 2020 8:31:56 AM"},{"uuid":"d72934ef9bbb47df9508fb1bb0453ca2","name":"42 in. W x 48 in. H Galvanized Steel Bent Frame Walk-Through Chain Link Fence Gate","barcode":"","productLineDesc":"","units":"0","priceLevel":"0","category":"Gate","model":"","make":"YardGuard","taxType":"all","vendorName":"","currentCount":0,"cost":59.72,"retailPrice":150.00,"notExhaustable":false,"customField1":"","customField2":"","customField4":"","customField5":"https://images.homedepot-static.com/productImages/69fb6bbd-2b98-4a47-b1fc-d90822d46e77/svn/yardgard-chain-link-fence-gates-328302a-64_1000.jpg","uuidLocation":"","descript":"","enabled":true,"installationCost":0.00,"width":0.0000,"height":0.0000,"weight":0.0000,"mapPlaceable":true,"territory":"","createUserId":"jdubin","updateUserId":"jdubin","createUserUuid":"71590418a3cc43b0b4fc29f5e86d6868","updateUserUuid":"71590418a3cc43b0b4fc29f5e86d6868","createTime":"Sep 27, 2020 8:35:24 AM","updateTime":"Sep 27, 2020 8:35:24 AM"}];
	
	
		
			
		var fenceType = 'wood';
		
		function selectItem(type)
		{
			fenceType = type;
			
			$('.selectedType').removeClass('selectedType');
			
			$($('#' + type + '_item')[0].parentNode).addClass( 'selectedType');
			
			$(".bottom-left-button").css("background", "linear-gradient(#d4e74f 0%, #79ae00 100%)");
			$(".bottom-left-button > .plus").html('<i class="fas fa-check"></i>');
			$.prompt.close();
		}
	
		function addToCart(uuid, i){
			let html = `
				<div class="collapse_selection open-addfield-fielddatarow pref-panel-style-selection-container">
					<div class="panel-item collapsible clearfix " id="` + uuid + `_cart" onclick="selectItem('` + uuid + `')" style="margin-right: 37px; margin-bottom: 10px;">
						<label class="toggletip tipped">
							<div class="right-sect">
							<p>` + fenceTypes[i].retailPrice + `</p>
							<p>` + fenceTypes[i].retailPrice + " X " + total_meters + " = " + fenceTypes[i].retailPrice*total_meters + `</p>
							<div class="add-button" onclick="removeItem(this.parentNode.parentNode.parentNode);">Cancel</div></div><div class="left-sect">`;
			let website = fenceTypes[i].customField5;
			if ( website && website.length > 0 )
				html += "<img width='100' height='100' src='" + website + "'><br/>" + fenceTypes[i].name + "<br/>";
			else
				html += "<img width='150' height='150' src='/sunbase/addons/measure/img/wood.png'><br/>" + fenceTypes[i].name + "<br/>";
			html += "<input type='radio' style='display:none' name='field_type' value='" + fenceTypes[i].uuid + "' class='rbEntry'/>";
			html += "</label>";
			html += "</div></div></div>";
			$(".cart").append(html);
		}
	
		function removeItem(dv){
			dv.style.display = "none";
		}
		
		
		function setFenceStyle()
		{
					
			var html = "<div style='text-align:center; overflow-x: auto; overflow-y:hidden; height:350px'> <div class='d-flex' style='margin-right:0; text-align:center'>";
			var idx = 0;
			for ( var i = 0; i < fenceTypes.length; ++i )
			{
				if ( fenceTypes[i].category === 'Fence' )
				{
					if ( idx > 0 && idx % 4 == 0 )
					{
						if ( idx > 0 )
							html += "</div>";
						html += "<div class='row' style='margin-right:0; text-align:center'>";
					}
					++idx;
					html += "<div class='collapse_selection open-addfield-fielddatarow pref-panel-style-selection-container'>";
					html += "<div class='panel-item collapsible clearfix " + ( fenceType === fenceTypes[i].uuid ? 'selectedType' : '') + "' id='" + fenceTypes[i].uuid + "_item' onclick='selectItem(\"" + fenceTypes[i].uuid + "\")' style='margin-right: 20px;'>";
					html += "<label class='toggletip tipped'>";
					html += "<div class='right-sect'>" + "<p class='price-style-1'>"+ "$" + + fenceTypes[i].retailPrice + "</p>" 
					html += '<div class="add-button" onclick="addToCart(\''+ fenceTypes[i].uuid +'\', ' + i + ');">Add Busket</div>' +  "</div>" + "<div class='left-sect'>"
						
					
						var website = fenceTypes[i].customField5;
						if ( website && website.length > 0 )
							html += "<img width='100' height='130' src='" + website + "'><br/>" + fenceTypes[i].name + "<br/>";
						else
							html += "<img width='150' height='150' src='/sunbase/addons/measure/img/wood.png'><br/>" + fenceTypes[i].name + "<br/>";
						html += "<input type='radio' style='display:none' name='field_type' value='" + fenceTypes[i].uuid + "' class='rbEntry'/>";
					html += "</label>";
					html += "</div></div></div>";			
				}
			}
			html += "</div></div>";	
			
			// console.log( html );
			
			$("#content-2").append(html);
			// var statesdemo = {
			// 	state1: {
			// 		title: '<b>Select Fence Style<b>',
			// 		html: html,
			// 		buttons: { "Cancel": 0 },
			// 		submit:function(e,v,m,f){								
			// 			e.preventDefault();
			// 			$.prompt.close();
			// 		}
			// 	}
			// };
	
			// $.prompt(statesdemo);
		}
	
	
		var gateType = '';
		var gateDblType = '';
		
		function selectGate(key, type)
		{
			if ( type == 1 )
				gateType = key;
			else if ( type == 2 )
				gateDblType = key;
			$(".selectedGate").removeClass("selectedGate");
			$($("#" + key + "_item")[0].parentNode).addClass('selectedGate');
			$(".bottom-right-button").css("background", "linear-gradient(#d4e74f 0%, #79ae00 100%)");
			$(".bottom-right-button > .plus").html('<i class="fas fa-check"></i>');
			$.prompt.close();
		}
		
		function loadDataSetFile()
		{
		}
		
		function getFenceMakeName()
		{
			var make = '';
			for ( var i = 0; i < fenceTypes.length; ++i )
			{
				if ( fenceType === fenceTypes[i].uuid )				
				{
					make = fenceTypes[i].make;
					break;
				}
			}
			return make;
		}
		
		function setGateStyle(type, force)
		{
			var flag = true;
			if ( force === undefined && type == 1 && gateType != null && gateType.length > 0 )
				return;
			else if ( force === undefined && type == 2 && gateDblType != null && gateDblType.length > 0  )
				return;
					
			var gateT = ( type  == 1 ? gateType : gateDblType );
			var count = 0;
			var html = "<div style='text-align:center; overflow-y:scroll; height:350px; overflow-x: hidden; overflow-y:auto'> <div class='row'  style='margin-right:0; text-align:center'>";
			var idx = 0;
			
			var fenceMake = getFenceMakeName();
			
			for ( var i = 0; i < fenceTypes.length; ++i )
			{
				if ( (fenceTypes[i].name.toLowerCase().indexOf('Gate') !== -1 || fenceTypes[i].category.toLowerCase().indexOf('gate') !== -1) && fenceTypes[i].make == fenceMake )
				{
					if ( idx > 0 && idx % 4 == 0 )
					{
						if ( idx > 0 )
							html += "</div>";
						html += "<div class='row' style='margin-right:0; text-align:center'>";
					}
					++idx;
					++count;
					html += "<div class='col-md-3 collapse_selection open-addfield-fielddatarow pref-panel-style-selection-container'>";
					html += "<div class='panel-item collapsible clearfix " + ( gateT === fenceTypes[i].uuid ? 'selectedType' : '') + "' id='" + fenceTypes[i].uuid + "_item' onclick='selectGate(\"" + fenceTypes[i].uuid + "\",\"" + type + "\")' style='margin-right: 20px;'>";
					html += "<label class='toggletip tipped''.>";
					html += "<p>" + fenceTypes[i].retailPrice + "</p>"
					html += '<div class="add-button" onclick="addToCart(\''+ fenceTypes[i].uuid +'\', ' + i + ');">Add Busket</div>'
					
						var website = fenceTypes[i].customField5;
						if ( website && website.length > 0 )
							html += "<img width='150' height='150' src='" + website + "'><br/>";
						else
							html += "<img width='150' height='150' src='/sunbase/addons/measure/img/wood.png'><br/>" + fenceTypes[i].name + "<br/>";
						html += "<input type='radio' style='display:none' name='field_type' value='" + fenceTypes[i].uuid + "' class='rbEntry'><strong class='panel-item-title'></strong>";
					html += "</label>";
					html += "</div></div>";			
				}
			}
			html += "</div>";			
			
			if ( count == 0 )
				flag = false;
			else
			{
				var statesdemo = {
					state1: {
						title: '<b>Select ' + ( type == 2 ? 'Double ' : '') + ' Gate Style<b>',
						html: html,
						buttons: { "Next": 1, "Cancel": 0 },
						submit:function(e,v,m,f){								
							e.preventDefault();
							if(v==1)
							{
								var item = $('.selectedType');
								if ( item && item.length > 0 )
								{
									if ( type == 1 )
										gateType = item[0].id;
									else
										gateDblType = item[0].id;
								}
							}
							$.prompt.close();
						}
					}
				};
	
				$.prompt(statesdemo);
			}
		}
	
	
	
	
	
	function saveDesign()
	{
		var data = [];
		
		for ( var i = 0; i < areacontainer.length; ++i )
		{
			var set = [];
			for ( var j = 0; j < areacontainer[i].length; ++j )
			{
				set.push( areacontainer[i][j] );
			}
			data.push( block );
		}	
		
		var root = {};
		root['data'] = data;
		root['lat'] = map.getCenter().lat();
		root['lng'] = map.getCenter().lng();
		root['design_uuid'] = 'a83e6943569341f88269cb7157bb10a4p';
	
		var markers = [];
		for ( var i = 0; i < canvasMarkers.length; ++i )
		{
			var d = {};
			d['lat'] = canvasMarkers[i].position.lat();
			d['lng'] = canvasMarkers[i].position.lng();
			d['uuid'] = canvasMarkers[i].uuid;
			d['img'] = canvasMarkers[i].icon.url;
			d['pin'] = canvasMarkers[i].pinType;
			markers.push( d ); 
		}
		root['markers'] = markers;
		
		$.ajax({
			url: "design_cmd.jsp", 
			type: "POST",             
			data: "cmd=design&uuid=a83e6943569341f88269cb7157bb10a4p&data_set=" + escape( JSON.stringify(root) ) + '&schema=fence',
			success: function(data2) {
				xdInfo("Design saved");
				
				if ( window.opener != null )
				{
					if ( typeof window.opener.designerUpdatedExternally === "function" )
						window.opener.designerUpdatedExternally();
				}
				
			}
	  });
		
	}
	
	
		function leadCapture()
		{
			var html = "<div class='leadCapture'><h2>L<img width='20px' src='img/lock.png'/> <b style='color:green;font-size: 24px;'>Just to be safe, we logged you out.</b><br/><br/>Enter your password to pick up where you left off. </center><br/><br/><label style='width:70px'>Current user: </label><input id='username' name='username' value='" + user + "'/><br/><br/><label style='width:70px'>Password: </label><input type='password' placeholder='Password' id='password' name='password' value='" + pass + "'/>";
			
		//	var html = '<label for="list">Login</label><input id="username" readonly="true" name="username" value="' + user + '"/><br/>';
		//	html += '<label for="email">Password</label><input type="password" id="password" name="password" value="' + pass + '"/><br/>';
	
		//$.prompt.close();
			var statesdemo = {
			state0: {
				html:html,
				title: "Start Fencing Estimate",
				buttons: { "Start Designing": 0 },
				position: { width: 700 },
				focus: "input[name='username']",
				submit:function(e,v,m,f){ 
	
					if ( v !== -1 && (f.username === '' || f.password === '' || f.username.indexOf('@') == -1 ) )
					{
						e.preventDefault(); 
						return false;
					}
					else if ( v == 0 )
					{
						$.ajax({
							type: "GET",
							url: "login_cmd.jsp?cmd=login",
							data: f,
							success: function (data) {
								if ( data.indexOf("uccess") !== -1 )
								{
									xdInfo("Reconnected");
									if ( $('.content').html().indexOf("img/spinning.gif") !== -1 )
										spaRefreshNavigatePage();
								}
							},
							error: function (XMLHttpRequest, textStatus, errorThrown) {
								console.log( textStatus );
							}
						});
					}
				}// end of submit
			  }
			}
	
			if ( statesdemo != null )
				$.prompt(statesdemo);
		}
		</script>	
	<script type="text/javascript">
		var id = '';

		
function closeTabWindow()
{
	window.close();

}		

function zoomAllIn()
{
	map.setZoom(20);
}

function getPolygonBounds(polygon) {
    var paths = polygon.getPaths(),
        bounds = new google.maps.LatLngBounds;
    return paths.forEach((function(path) {
        for (var ar = path.getArray(), i = 0, l = ar.length; i < l; i++) bounds.extend(ar[i])
    })), bounds
}

function setSelectedSection(section, polygon) {
    for (const s of sections)
        if (section && s === section || polygon && s.polygon === polygon) {
            selectedSection = s, $jq("#angleRange").val(s.angle), $jq("#angleRangeValue").html(s.angle + "&#176;");
            for (let tiltVal of Object.keys(tiltValues)) tiltValues[tiltVal] == s.pitch && $jq("#tiltRange").val(tiltVal);
            $jq("#tiltRangeValue").html(s.pitch + "&#176;"), setRoofOrientation(s.roofOrientation), setShading(s.shading), s.polygon.setOptions({
                fillColor: "orange"
            })
        } else s.polygon.setOptions({
            fillColor: "black"
        })
}


var selectedSection = null;
var selectedPanels = [];
var canvasMarkers = [];

function differenceNum(num1, num2){
  return (num1 > num2)? num1-num2 : num2-num1
}


var map = null;

function map_click_yard(event){	

	if ( $('#doublegate').hasClass('activeMenuActionD') )
	{
		createPoint(event.latLng.lat(), event.latLng.lng(), 'doublegate' );
	}		
	else if ( $('#gate').hasClass('activeMenuActionD') )
	{
		createPoint(event.latLng.lat(), event.latLng.lng(), 'gate' );
	}			
	else if ( $('#otherSvg').hasClass('activeMenuActionZ') )
	{
		createPoint(event.latLng.lat(), event.latLng.lng(), subaction );
	}
	else if ( $('#drawSvg').hasClass('activeMenuActionZ') )
	{
		if(areacontainer_current == null){
			createNewArea()
		}
		areacontainer[areacontainer_current].push(event.latLng);
		activeLine = true;
		display();
		$(".context-menu").css('visibility','hidden');
	}
}



function initialize_map(){


	var latlng = new google.maps.LatLng(28.484535,-81.0891333);
    var myOptions = {
        zoom: 20,
        center: latlng,
        mapTypeId: google.maps.MapTypeId.HYBRID,
        draggableCursor: 'crosshair',
        // streetViewControl: false,
        mapTypeControlOptions: {
            style: google.maps.MapTypeControlStyle.DROPDOWN_MENU
        },
        tilt: 0
    };
    map = new google.maps.Map(document.getElementById("map"), myOptions);
    google.maps.event.addListener(map, 'click', map_click_yard);
    geocoder = new google.maps.Geocoder();
    
    overlay = new google.maps.OverlayView();
    overlay.draw = function() {};
    overlay.setMap(map);

	let location = document.getElementById("location");
	let optionsForLocation = {
		componentRestrictions: { country: "us" },
		fields: ["formatted_address", "geometry", "name"],
		origin: map.getCenter(),
		strictBounds: false,
		types: ["establishment"],
	}
	const autocomplete = new google.maps.places.Autocomplete(location, optionsForLocation);

	autocomplete.addListener("place_changed", () => {
		const place = autocomplete.getPlace();

		if (!place.geometry) {
			window.alert("No details available for input: '" + place.name + "'");
			return;
		}

		if (place.geometry.viewport) {
			map.fitBounds(place.geometry.viewport);
			map.setZoom(20);
		} else {
			map.setCenter(place.geometry.location);
			map.setZoom(20);
		}
	});

    google.maps.event.addListener(map, 'idle', function() {
	   projection = overlay.getProjection();
	   //console.log(projection);
		if(id!='' && readonly_ran == false){
			readonly_ran = true;
			setReadonly(id);
		}
		set_dimensions();
		
		loadDataSetFile();
	})
	
//	var connector = new google.maps.Polyline();
//	var activeLine = false;
	google.maps.event.addListener(map, 'mousemove', function(pt){
	//	connector.setMap(null);
		if ( areacontainer[areacontainer_current] && areacontainer[areacontainer_current].length > 0 )
		{
		var dist = document.getElementById('currentDist');
		if ( dist )
		{
			var coord = areacontainer[areacontainer_current][areacontainer[areacontainer_current].length-1];
//			document.getElementById('latlgn').innerHTML = pt.latLng;

			var lineTwoPoints = [
				coord,
				pt.latLng
			];
			
	var p1 = new LatLon(coord.lat(), coord.lng()); 
	var p2 = new LatLon(pt.latLng.lat(), pt.latLng.lng()); 
			
			var km = p1.distanceTo(p2);
			var html = addCommas(parseFloat(km/0.0003048).toFixed(2));
			dist.value = html;
		}
		/*connector = new google.maps.Polyline({//<--note the this
			map: map,
			path: lineTwoPoints,
			strokeColor: "yellow",
			strokeOpacity: 1.0,
			strokeWeight: 2,
			clickable: false,
			});
		*/	
		}
	});
	
	google.maps.event.addListener(map, 'dragstart', function(){
		$(".polygon-label").hide();
	});
	google.maps.event.addListener(map, 'dragend', display);
    google.maps.event.addListener(map, 'zoom_changed', display);
}



		function xdError(msg)
		{
			$.growl.error({ message: msg});
		}
		function xdInfo(msg)
		{
			$.growl.notice({ message: msg});
		}
		function xdWarn(msg)
		{
			$.growl.warning({ message: msg });
		}

function getPanelHeight()
{
	var height = parseFloat( document.getElementById('panelHeight').value );
	if ( !height )
		return 66;
	
	height /= 39.370;

	return height;
							
}

	</script>
<script type="text/javascript" charset="UTF-8" src="./yard_measure_files/overlay.js(1).download"></script>

	  
	  <script type="text/javascript" charset="UTF-8" src="./yard_measure_files/common.js.download"></script><script type="text/javascript" charset="UTF-8" src="./yard_measure_files/util.js.download"></script><script type="text/javascript" charset="UTF-8" src="./yard_measure_files/map.js.download"></script><script type="text/javascript" charset="UTF-8" src="./yard_measure_files/geocoder.js.download"></script><script type="text/javascript" charset="UTF-8" src="./yard_measure_files/overlay.js(1).download"></script><script type="text/javascript" charset="UTF-8" src="./yard_measure_files/onion.js.download"></script><script type="text/javascript" charset="UTF-8" src="./yard_measure_files/controls.js.download"></script><script type="text/javascript" charset="UTF-8" src="./yard_measure_files/poly.js.download"></script><script type="text/javascript" charset="UTF-8" src="./yard_measure_files/marker.js.download"></script></head>

<body style="cursor: auto;">	


<script>
var subaction = 'meter';

function setOtherSubSvgAction(v)
{
	subaction = v;
	
	$('#other_draw .activeMenuActionZ').removeClass('activeMenuActionZ');
	
	if ( v == 'select' )
	{
		$('#selectBox').addClass('activeMenuActionZ');
	}
	else if ( v == 'batt' )
	{
		$('#battBox').addClass('activeMenuActionZ');
	}
	else if ( v == 'meter' )
	{
		$('#meterBox').addClass('activeMenuActionZ');
	}
	else if ( v == 'inverter' )
	{
		$('#inverterBox').addClass('activeMenuActionZ');
	}
	else if ( v == 'deleteBox' )
	{
		$('#deleteBox').addClass('activeMenuActionZ');
	}
	else if ( v == 'setStyleBox' )
	{
		$('#setStyleBox').addClass('activeMenuActionD');
	}
	
}

function deleteInverterSelected()
{
	pinType = "delete";
}

function setDrawSubSvgAction(m)
{
	$('.activeMenuActionD').removeClass('activeMenuActionD');
	$('#' + m ).addClass('activeMenuActionD');	
}

function getInvoiceEntry()
{      
	var data = '&item1=Roof%20Replacement&item1_amt=' + document.getElementById('totalPaidAmount').value;
	data += '&item2=Plywood%20Fee&item2_amt=' + document.getElementById('financeCost').value;
	data += '&item3=Supplemental%20Fee&item3_amt=' + document.getElementById('stubCost').value;

	createInvoiceEntry(data);
}


function onEstimate()
{
	var permiter = Math.ceil( parseFloat($('.fencePermiter').html()) );

	var productFence = null;
	var gate = null;
	var dblGate = null;
	
	var gateCount = 0;
	var gateDblCount = 0;
	for ( var i = 0; i < canvasMarkers.length; ++i )
	{
		if ( canvasMarkers[i].pinType === 'gate' || canvasMarkers[i].icon.url === 'img/gate.png' )
		{
			++gateCount;
		}
		else
		{
			if ( canvasMarkers[i].pinType === 'doublegate' || canvasMarkers[i].icon.url === 'img/doublegate.png' )
				++gateDblCount;
		}
	}


	if ( fenceType === null || fenceType.length < 10 )
	{
		setFenceStyle();
		return;
	}
	if ( gateCount > 0 && (gateType === null || gateType.length < 10 ) )
	{
		if ( setGateStyle(1) )
			return;
	}
	if ( gateDblCount > 0 && (gateDblType === null || gateDblType.length < 10 ) )
	{
		if ( setGateStyle(2) )
			return;
	}
	


	for ( var i = 0; i < fenceTypes.length; ++i )
	{
		if ( fenceTypes[i].uuid === fenceType )
		{
			productFence = fenceTypes[i];
		}
		else if ( fenceTypes[i].uuid === gateType )
		{
			gate = fenceTypes[i];
		}
		else if ( fenceTypes[i].uuid === gateDblType )
		{
			dblGate = fenceTypes[i];
		}
	}
	

	var fenceCost = 0;
	var gateCost = 0;
	var gateDblCost = 0;
	
	var html = '';
	if ( productFence )
	{
		fenceCost = ( permiter * productFence.loadedCost );
		if ( productFence.loadedCost === undefined || productFence.loadedCost == 0 || isNaN(fenceCost) )
		{
			if ( isNaN(productFence.retailPrice) || isNaN(productFence.installationCost) )
				fenceCost = "Call";
			else
				fenceCost = ( permiter * productFence.retailPrice + permiter * productFence.installationCost );
		}
		html = '<b>Fence ' + productFence.name + ' ' + permiter + "'</b><br/>"; // $" + fenceCost + '<br/>';
	}
	
	
	if ( gateCount > 0 && gate )
	{
		gateCost = ( gateCount * gate.loadedCost );
		if ( gate.loadedCost === undefined || gate.loadedCost == 0 || isNaN(gateCost) )
		{
			if ( isNaN(gate.retailPrice) || isNaN(gate.installationCost) )
				gateCost = "Call";
			else
				gateCost = ( gateCount * gate.retailPrice + gateCount * gate.installationCost );
		}
		html += '<b>Gate' + gate.name + ' x' + gateCount + "'</b><br/>"; //  $" + gateCost + '<br/>';
	}
	
	if ( gateDblCount > 0 && dblGate )
	{
		gateDblCost = ( gateDblCount * dblGate.loadedCost );
		if ( dblGate.loadedCost === undefined || dblGate.loadedCost == 0 || isNaN(gateDblCost) )
		{
			if ( isNaN(dblGate.retailPrice) || isNaN(dblGate.installationCost) )
				gateDblCost = "Call";
			else
				gateDblCost = ( gateDblCount * dblGate.retailPrice + gateDblCount * dblGate.installationCost );
		}
		html += '<b>Gate (double) ' + dblGate.name + ' x' + gateDblCount + "'</b><br/>"; //  $" + gateDblCost + '<br/>';
	}
	
	var total = ( fenceCost + gateCost + gateDblCost);
	
	var range = thousands_separators(total) + " - $" + thousands_separators( total * 1.10 );
	
	html += '<hr/><div class="row"> <div class="col-md-4"><b>Estimate Range </b></div><div class="col-md-4"> $' + range + '</div></div><br/>';
	// showEstimate();


	createQuote(productFence, permiter, fenceCost, gate, gateCount, gateCost,  dblGate, gateDblCount, gateDblCost );
	saveDesign();
	
	var statesdemo = {
		state1: {
			title: '<b>Estimated Cost<b>',
			html: html,
			buttons: { "Close": 0 },
			submit:function(e,v,m,f){								
				e.preventDefault();
				$.prompt.close();
			}
		}
	};

	$.prompt(statesdemo);

}


function setSvgAction(m)
{
	document.getElementById('searchBox').style = 'overflow-x: auto; display: none';
	document.getElementById('saveBox').style = 'overflow-x: auto; display: none';
	
	if ( m == 'drawSvg' )
	{
		$('.activeMenuActionZ').removeClass('activeMenuActionZ');
		$('#drawSvg').addClass('activeMenuActionZ');
		
		document.getElementById('designer').style = 'overflow-x: auto; display: block';
	}
	else if ( m == 'otherSvg' )
	{
		$('.activeMenuActionZ').removeClass('activeMenuActionZ');
		$('#otherSvg').addClass('activeMenuActionZ');
		document.getElementById('other_draw').style = 'overflow-x: auto; display: block';
		
	}
	else if ( m == 'saveSvg' )
	{
		$('.activeMenuActionZ').removeClass('activeMenuActionZ');
		$('#saveSvg').addClass('activeMenuActionZ');
		document.getElementById('saveBox').style = 'overflow-x: auto; display: block';		
	}
	else if ( m == 'arraySvg' )
	{
		$('.activeMenuActionZ').removeClass('activeMenuActionZ');
		$('#arraySvg').addClass('activeMenuActionZ');
		document.getElementById('arrayBox').style = 'overflow-x: auto; display: block';		
	}

//			<div id='searchBox' style='overflow-x: auto; display: none'>				
//		<div id='designer' style='overflow-x: auto; min-height:1500px'>				

}

</script>

<div style="display:none">
  <form id="form1">
	 <input type="text" id="file" name="file">
	 <input type="text" value="a83e6943569341f88269cb7157bb10a4p" id="parentUuid" name="parentUuid">
  </form>
</div>
<div class="button-group-1">
	<div class="button-1-successed input-button centerd-text" id="location-btn"><i class="middle-font fas fa-map-marker-alt"></i></div>
	<div class="button-1 color-input-button centerd-text" id="pen-btn"><i class="middle-font fas fa-pen-nib"></i></div>
	<div class="color-section" id="color-section" style="display:none">
		<div class="top-section-1 d-flex">
			<i class="pen fas fa-pen-nib"></i>
			<p class="text-style-2">Drawing Fence Area</p>
		</div>
		<div class="content">
			<div class="select-co">select line color</div>
			<div class="color-line-section">
				<div class="d-flex">
					<div href="#" class="color-hover mavi selected" onclick="setStrokeColor(this, '#27FF48');"></div>
					<div href="#" class="color-hover kirmizi" onclick="setStrokeColor(this, '#FF5858');"></div>
					<div href="#" class="color-hover pembe" onclick="setStrokeColor(this, '#48FFEA');"></div>
					<div href="#" class="color-hover orange" onclick="setStrokeColor(this, '#3E5BBE');"></div>
					<div href="#" class="color-hover yesil" onclick="setStrokeColor(this, '#4879FF');"></div>
					<div href="#" class="color-hover six" onclick="setStrokeColor(this, '#FFE348');"></div>
					<div href="#" class="color-hover seven" onclick="setStrokeColor(this, '#D472FF');"></div>
				</div>
			</div>
		</div>
		<div class="d-flex justify-content-space-around">
			<div class="button-2 mr-1" id="pen-done">Cancel</div>
			<div class="button-2 black-button" id="pen-done" onclick="display();$('#pen-done').click();">Done</div>
		</div>
	</div>

	<div class="button-1 gate-input-button centerd-text" id="gate-btn"><i class="middle-font fas fa-dungeon"></i></div>
	<div class="gate-section" id="gate-section" style="display:none">
		<div class="top-section-1 d-flex">
			<i class="pen fas fa-dungeon"></i>
			<p class="text-style-2">Add Gate to Your Plan</p>
		</div>
		<div class="content">
			<div class="select-co">select gate type</div>
			<div class="gate-type-section">
				<div class="d-flex full-width">
					<div class="left-section-gate gate-selected" onclick="select_gate(1);">
						<img src="img/gate__1_.png">
						<p>Single gate</p>
					</div>
					<div class="right-section-gate" onclick="select_gate(2);">
						<img src="img/gate__2_.png">
						<p>Double gate</p>
					</div>
				</div>
			</div>
		</div>
		<div class="d-flex justify-content-space-around mt-1">
			<div class="button-2 mr-1" id="gate-done">Cancel</div>
			<div class="button-2 black-button" id="gate-done" onclick="add_gate();$('#gate-done').click();">Done</div>
		</div>
	</div>
</div>
<div class="gates"></div>
<div class="button-group-2">
	<div class="bottom-left-button mr-1 " id="bottom-btn-1" onclick="setFenceStyle(); return false">
		<img src="img/fence-1.png">
		<p>SELECT<br>FENCING TYPE</p>
		<div class="plus"><i class="fas fa-plus"></i></div>
	</div>
	<div class="bottom-right-button" id="bottom-btn-2">
		<img src="img/fence-2.png">
		<p>SELECT<br>GATE TYPE</p>
		<div class="plus"><i class="fas fa-plus"></i></div>
	</div>
</div>
<div class="button-group-3">
	<div class="button-style-4 mr-1" onclick="location.reload();">Reset plan</div>
	<div class="button-style-5 mr-1" onclick="save_plan();">Save plan</div>
	<div class="button-style-6">Request price</div>
</div>
<div class="bottom-window" id="bottom-window" >
	<div class="bottom-window-header">
		<div class="text-section-2">Select Fence Style</div>
		<div class="jqiclose" id="close-btn1">×</div>
	</div>
	<div class="content-2" id="content-2">

	</div>
</div>
<div class="bottom-window-2" id="bottom-window-2">
	<div class="bottom-window-header">
		<div class="text-section-3">Select gate Style</div>
		<div class="jqiclose" id="close-btn2">×</div>
	</div>
	<div class="content-3" id="content-3">
		<div class="d-flex" style="margin-right:0; text-align:center"><div class="col-md-3 collapse_selection open-addfield-fielddatarow pref-panel-style-selection-container"><div class="panel-item collapsible clearfix " id="770495095b624afe8ed683b92bf3e988_item" onclick="selectGate(&quot;770495095b624afe8ed683b92bf3e988&quot;,&quot;1&quot;)" style="margin-right: 20px;"><label class="toggletip tipped" '.=""><label class="toggletip tipped"><div class="left-sect"><p>275</p><div class="add-button" onclick="addToCart('770495095b624afe8ed683b92bf3e988_cart', 6);">Add Busket</div></div><img width="150" height="150" src="https://images.homedepot-static.com/productImages/545dd536-c0fd-4868-88d2-dc0d30707087/svn/white-veranda-vinyl-fence-gates-181972-64_1000.jpg"><br><input type="radio" style="display:none" name="field_type" value="770495095b624afe8ed683b92bf3e988" class="rbEntry"><strong class="panel-item-title"></strong></label></div></div></div>
	</div>
</div>
<div class="location-section" id="location-section" style="display:none">
	<div class="header-1">
		<i class="fas fa-map-marker-alt"></i><span class="text-2">Let’s Find Your Home</span>
	</div>
	<div class="content-01 mb-1">
		<div class="input-section-1 width-1">
			<input class="location-2" id="location" placeholder="What's your location?">
			<div class="buttom-3"><i class="fas fa-street-view"></i>Get My Location</div>
		</div>
		<div class="input-section-1 width-1 mt-1">
			<input class="location mr-1" id="fullname" placeholder="Name Surname">
			<input class="location mr-1" id="phone" placeholder="Phone Number">
			<input class="location mr-1" id="email" placeholder="Email Address">
			<input class="location" id="Zip" placeholder="Zip Code">
		</div>
		<div class="d-flex width-1 mt-1">
			<p class="select">What is the property type?</p>
			<select name="property" id="property">
				<option value="volvo">Residental</option>
				<option value="saab">Saab</option>
				<option value="opel">Opel</option>
				<option value="audi">Audi</option>
			</select>
		</div>
	</div>
	<div class="footer-1">
		<div class="button-4 mr-1" id="cancel" onclick="$('#location-btn').click();">Cancel</div>
		<div class="button-4 black-button" id="done" onclick="done_location();$('#location-btn').click();">Done</div>
	</div>
</div>
<div class="fence-part-list"></div>
<div class="fence-total"></div>
<div class="fence-gates"></div>
<div class="cart"></div>
<div class="thanks" style="display:none;">
	<div class="top-section-4">
		<img src="img/check.png">
		<p class="font-style-4">Thank you</p>
		<p class="font-style-5">for submitting your project design,<br>
			a member of our team will be in touch shortly</p>
	</div>
	<div class="middle-section-4">
		<div class="name-1 mr-2">Yılmaz SATTI</div>
		<div class="phone-1 mr-2">905396404573</div>
		<div class="email-1 mr-2">yilmaz.satti@gmail.com</div>
		<div class="button-edit">edit</div>
	</div>
	<div class="bottom-section-4">
		<div class="button-style-7 mr-1">Save Pdf Plan</div>
		<div class="button-style-7 mr-1">Print Plan</div>
		<div class="button-style-7 mr-1">Send My Mail Address</div>
	</div>
</div>
<!-- <div class="color-section">
	<div class="top-section-1">
		<i class="middle-font fas fa-pen-nib"></i>
		<p>Drawing Fence Area</p>
	</div>
	<div class="content">
		<div class="">select line color</div>
		<div class="color-line-section">
			<ul>
				<li><a href="#" class="mavi"></a></li>
				<li><a href="#" class="kirmizi"></a></li>
				<li><a href="#" class="pembe"></a></li>
				<li><a href="#" class="orange"></a></li>
				<li><a href="#" class="yesil"></a></li>    
			</ul>
		</div>
	</div>
</div> -->

<div style="width:100%; display: flex" class="row">		
	<div class="logo-1">
		<div class="left-sec">
			<img src="img/logo(fence).svg">
			<div class="text-1">
				<p class="top-text-1">
					Fencing
				</p>
				<p class="bottom-text-1">
					Calculator
				</p>
			</div>
		</div>
		<div class="right-sec">
			<div class="text-2">
				How its Works
			</div>
			<div class="maker-1">
				?
			</div>
		</div>
	</div>
	<div id="drawSvg" class="md-col-3 col-xs-4 menuActionZ activeMenuActionZ" onclick="setSvgAction(&#39;drawSvg&#39;); return false">
		<span style="border: 10px; box-sizing: border-box; display: block; font-family: Roboto, sans-serif; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); cursor: pointer; text-decoration: none; margin: 0px; padding: 0px; outline: none; font-size: 16px; font-weight: inherit; position: relative; color: rgb(33, 33, 33); transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; background: none;" tabindex="0"></span>
		<div>
			<span style="border: 10px; box-sizing: border-box; display: block; font-family: Roboto, sans-serif; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); cursor: pointer; text-decoration: none; margin: 0px; padding: 0px; outline: none; font-size: 16px; font-weight: inherit; position: relative; color: rgb(33, 33, 33); transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; background: none;" tabindex="0"><span style="height: 100%; width: 100%; position: absolute; top: 0px; left: 0px; overflow: hidden; pointer-events: none; z-index: 1;"></span></span>
			<div style="margin-left: 0px; padding: 30px 26px 16px 22px; text-align:center; position: relative;">
				<svg id="drawSvg" style="display: inline-block; fill: black; margin-left:30px; height: 48px; width: 48px; user-select: none; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; position: absolute; top: 8px; left: 16px; margin-top: 8px" viewBox="0 0 48 48">
				<path d="M17.75 7L14 3.25l-10 10V17h3.75l10-10zm2.96-2.96c.39-.39.39-1.02 0-1.41L18.37.29c-.39-.39-1.02-.39-1.41 0L15 2.25 18.75 6l1.96-1.96z"></path>
				<path d="M0 20h24v4H0z" fill-opacity=".36"></path></svg>
				<br><div>
					Draw Tool
				</div>
			</div>
		</div>
	</div>

	
	<div id="arraySvg" class="md-col-3 col-xs-4 menuActionZ" onclick="setFenceStyle(); return false">
		<span style="border: 10px; box-sizing: border-box; display: block; font-family: Roboto, sans-serif; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); cursor: pointer; text-decoration: none; margin: 0px; padding: 0px; outline: none; font-size: 16px; font-weight: inherit; position: relative; color: rgb(33, 33, 33); transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; background: none;" tabindex="0"></span>
		<div>
			<span style="border: 10px; box-sizing: border-box; display: block; font-family: Roboto, sans-serif; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); cursor: pointer; text-decoration: none; margin: 0px; padding: 0px; outline: none; font-size: 16px; font-weight: inherit; position: relative; color: rgb(33, 33, 33); transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; background: none;" tabindex="0"><span style="height: 100%; width: 100%; position: absolute; top: 0px; left: 0px; overflow: hidden; pointer-events: none; z-index: 1;"></span></span>
			<div style="margin-left: 0px; padding: 30px 26px 16px 22px; text-align:center; position: relative;">
				<img src="./yard_measure_files/configui.png" style="display: inline-block; fill: black; margin-left:30px; height: 30px; width: 30px; user-select: none; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; position: absolute; top: 8px; left: 16px; margin-top: 8px">
				<br><div>
					Pick Style
				</div>
			</div>
		</div>
	</div>

	<div id="" class="md-col-3 menuActionZ col-xs-4 " onclick="return false;">
		<span style="border: 10px; box-sizing: border-box; display: block; font-family: Roboto, sans-serif; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); cursor: pointer; text-decoration: none; margin: 0px; padding: 0px; outline: none; font-size: 16px; font-weight: inherit; position: relative; color: rgb(33, 33, 33); transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; background: none;" tabindex="0"></span>
		<div>
			<span style="border: 10px; box-sizing: border-box; display: block; font-family: Roboto, sans-serif; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); cursor: pointer; text-decoration: none; margin: 0px; padding: 0px; outline: none; font-size: 16px; font-weight: inherit; position: relative; color: rgb(33, 33, 33); transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; background: none;" tabindex="0"><span style="height: 100%; width: 100%; position: absolute; top: 0px; left: 0px; overflow: hidden; pointer-events: none; z-index: 1;"></span></span>
			<div style="margin-left: 0px; padding: 50px 26px 16px 22px; text-align:center; position: relative;" onclick="return false">
				<img src="./yard_measure_files/permiter.jpg" style="display: inline-block; fill: black; margin-left:30px; height: 30px; width: 30px; user-select: none; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; position: absolute; top: 8px; left: 16px; margin-top: 8px">
				<div>
					Permiter<br>
					<div class="fencePermiter">79.69'</div>
				</div>
			</div>
		</div>
	</div>
	<script>
		$('#location-btn').on('click', function() {
			$('#color-section').hide();
			$('#gate-section').hide(300);
			$('#pen-btn').show();
			$('#gate-btn').show(300);
			$('#location-section').animate({ width: 'toggle'});
		});

		$('#pen-btn').on('click', function() {
			$(this).hide();
			$('#location-section').hide(300);
			$('#gate-section').hide(300);
			$('#color-section').show(300);
			$('#gate-btn').show(300);
		});

		$('#pen-done').on('click', function() {
			$('#color-section').hide(300);
			$('#pen-btn').show(300);
		});
		$('#gate-done').on('click', function() {
			$('#gate-section').hide(300);
			$('#gate-btn').show(300);
		});

		$('#gate-btn').on('click', function() {
			$('#location-section').hide(300);
			$('#color-section').hide(300);
			$('#gate-btn').hide(300);
			$('#pen-btn').show(300);
			$('#gate-section').toggle(300);
		});

		$("#bottom-btn-1").on('click', function() {
			var $el = $('#bottom-btn-1').parent();
			var bottom = $(window).height() - $el.offset().top - $el.height();
			if(bottom === 250 && $("#bottom-window-2").css("display") === 'none') {
				$(this).parent().animate({bottom: 30});
			} else {
				$(this).parent().animate({bottom: 250});
			}
			$("#bottom-window-2").hide();
			$("#bottom-window").slideToggle(400);
		});
		$("#bottom-btn-2").on('click', function() {
			var $el = $('#bottom-btn-2').parent();
			var bottom = $(window).height() - $el.offset().top - $el.height();
			if(bottom === 250 && $("#bottom-window").css("display") === 'none') {
				$(this).parent().animate({bottom: 30});
			} else {
				$(this).parent().animate({bottom: 250});
			}
			$("#bottom-window").hide();
			$("#bottom-window-2").slideToggle(400);
		});
		$("#close-btn1").on('click', function() {
			$("#bottom-btn-1").parent().animate({bottom: 30});
			$(this).closest('div.bottom-window').slideUp(400);
		});
		$("#close-btn2").on('click', function() {
			$("#bottom-btn-2").parent().animate({bottom: 30});
			$(this).closest('div.bottom-window-2').slideUp(400);
		});
	</script>
	

	<!-- <div style="margin-left:10px" class="col-md-5">
		<img style="max-height:100px" src="./yard_measure_files/fence.jpg"><br>
		<div style="margin-top: 10px; margin-left: 60px; font-size: 19px; font-weight: 600">
		
		
			ABC Fence Company<br>
			800-435-9800
		</div>
	</div> -->




	<!-- <div style="position: fixed; right:0; display:flex">
		<div class="md-col-3 menuActionZ" onclick="onEstimate(); return false;" style="margin-left:30px; background: darkgreen; color: white; height: 55px; text-align: center; padding-top: 15px;">
			<span style="border: 10px; box-sizing: border-box; display: block; font-family: Roboto, sans-serif; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); cursor: pointer; text-decoration: none; margin: 0px; padding: 0px; outline: none; font-size: 16px; font-weight: inherit; position: relative; color: rgb(33, 33, 33); transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; background: none;" tabindex="0"></span>
			<div>
				<span style="border: 10px; box-sizing: border-box; display: block; font-family: Roboto, sans-serif; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); cursor: pointer; text-decoration: none; margin: 0px; padding: 0px; outline: none; font-size: 16px; font-weight: inherit; position: relative; color: rgb(33, 33, 33); transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; background: none;" tabindex="0"><span style="height: 100%; width: 100%; position: absolute; top: 0px; left: 0px; overflow: hidden; pointer-events: none; z-index: 1;"></span></span>
				<div style="color:white; margin-left: 0px; position: relative; text-align:center">
					<span style="color:white">Estimate</span> <br>
				</div>
			</div>
		</div>
		
		<div class='md-col-3 menuActionZ' onclick="saveDesign(); return false;" style='margin-left:30px; background: darkgreen; color: white; height: 55px; text-align: center; padding-top: 15px;'>
			<span style="border: 10px; box-sizing: border-box; display: block; font-family: Roboto, sans-serif; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); cursor: pointer; text-decoration: none; margin: 0px; padding: 0px; outline: none; font-size: 16px; font-weight: inherit; position: relative; color: rgb(33, 33, 33); transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; background: none;" tabindex="0"></span>
			<div>
				<span style="border: 10px; box-sizing: border-box; display: block; font-family: Roboto, sans-serif; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); cursor: pointer; text-decoration: none; margin: 0px; padding: 0px; outline: none; font-size: 16px; font-weight: inherit; position: relative; color: rgb(33, 33, 33); transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; background: none;" tabindex="0"><span style="height: 100%; width: 100%; position: absolute; top: 0px; left: 0px; overflow: hidden; pointer-events: none; z-index: 1;"></span></span>
				<div style="color:white; margin-left: 0px; position: relative; text-align:center">
					<span style='color:white'>Save Design</span> <br>
				</div>
			</div>
		</div>
		<div class="md-col-3 menuActionZ" onclick="closeTabWindow(); return false;" style="margin-left:30px; background: dodgerblue; color: white; height: 55px; text-align: center; padding-top: 15px;">
			<span style="border: 10px; box-sizing: border-box; display: block; font-family: Roboto, sans-serif; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); cursor: pointer; text-decoration: none; margin: 0px; padding: 0px; outline: none; font-size: 16px; font-weight: inherit; position: relative; color: rgb(33, 33, 33); transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; background: none;" tabindex="0"></span>
			<div>
				<span style="border: 10px; box-sizing: border-box; display: block; font-family: Roboto, sans-serif; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); cursor: pointer; text-decoration: none; margin: 0px; padding: 0px; outline: none; font-size: 16px; font-weight: inherit; position: relative; color: rgb(33, 33, 33); transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; background: none;" tabindex="0"><span style="height: 100%; width: 100%; position: absolute; top: 0px; left: 0px; overflow: hidden; pointer-events: none; z-index: 1;"></span></span>
				<div style="margin-left: 0px; position: relative; text-align:center">
					<span style="color:white">Close Window</span> <br>
				</div>
			</div>
		</div>
	</div> -->
</div>



	<div id="container" style="display:flex">
		<div id="right2" style="overflow:hidden; width: 100%; height:100%;">
<div id="map" style="position: relative; overflow: hidden;width:100%; height:100%">
</div>

		<div style="width:0%;  overflow-x: auto">
		
		<div id="saveBox" style="overflow-x: auto; display: none">
			<div id="title">Save Menu</div>		
							
						

			<br>
			<center>
				<button style="padding:10px" onclick="saveDesign();saveImage(); return false" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">Start Design/Image</span></button>
			</center>			
			<br>			
						
			<div onclick="saveDesign(); return false;" style="color: black; display: block; font-size: 16px; line-height: 16px; position: relative; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; margin-left: 0px; padding: 20px 16px 16px 72px;">
				<svg style="display: inline-block; color: black; fill: black; height: 24px; width: 24px; user-select: none; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; position: absolute; top: 16px; left: 16px; margin-top: 10px; margin-left: 8px;" viewBox="0 0 24 24">
				<path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"></path></svg>
				<div>
					Save Design Only
				</div>
				<div style="font-size: 14px; lne-height: 16px; height: 16px; margin: 4px 0px 0px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
					<span></span>
				</div>
			</div>
			<div onclick="saveImage(); return false;" style="color: black; display: block; font-size: 16px; line-height: 16px; position: relative; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; margin-left: 0px; padding: 20px 16px 16px 72px;">
				<svg style="display: inline-block; color: black; fill: black; height: 24px; width: 24px; user-select: none; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; position: absolute; top: 16px; left: 16px; margin-top: 10px; margin-left: 8px;" viewBox="0 0 24 24">
				<path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"></path></svg>

				<div>
					Save Image Only
				</div>
				<div style="font-size: 14px; lne-height: 16px; height: 16px; margin: 4px 0px 0px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
					<span></span>
				</div>
			</div>
						
						
		</div>
		<div id="searchBox" style="overflow-x: auto; display: none">				
			<table>
				<tbody><tr>
					
					<td><input type="text" id="address" placeholder="Your Address" value="" class="ui-autocomplete-input" autocomplete="off" role="textbox" aria-autocomplete="list" aria-haspopup="true"></td>
					<td><button id="search-btn" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text"><span class="ui-button-text">SEARCH</span></span></button></td>
				</tr>
			</tbody></table>
		</div>
		
				
<!-- start -->
  <div class="drawingAction activeMenuActionD" id="drawBorder" onclick="setDrawSubSvgAction(&quot;drawBorder&quot;); newBox = true; return false;">
		<span style="border: 10px; box-sizing: border-box; display: block; font-family: Roboto, sans-serif; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); cursor: pointer; text-decoration: none; margin: 0px; padding: 0px; outline: none; font-size: 16px; font-weight: inherit; position: relative; color: rgb(33, 33, 33); line-height: 16px; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; background: none;" tabindex="0"></span>
		<div class="drawingAction" id="drawAction" onclick="setDrawSubSvgAction(&#39;draw&#39;)">
			<span style="border: 10px; box-sizing: border-box; display: block; font-family: Roboto, sans-serif; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); cursor: pointer; text-decoration: none; margin: 0px; padding: 0px; outline: none; font-size: 16px; font-weight: inherit; position: relative; color: rgb(33, 33, 33); line-height: 16px; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; background: none;" tabindex="0"><span style="height: 100%; width: 100%; position: absolute; top: 0px; left: 0px; overflow: hidden; pointer-events: none; z-index: 1;"></span></span>
			<div style="margin-left: 0px; padding: 20px 16px 16px 72px; position: relative;">
				<svg id="defaultAreaSvg" style="display: inline-block; fill: currentcolor; height: 24px; width: 24px; user-select: none; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; position: absolute; top: 16px; left: 16px; margin-top: 10px; margin-left: 8px;" viewBox="0 0 24 24">
				<path d="M17.75 7L14 3.25l-10 10V17h3.75l10-10zm2.96-2.96c.39-.39.39-1.02 0-1.41L18.37.29c-.39-.39-1.02-.39-1.41 0L15 2.25 18.75 6l1.96-1.96z"></path>
				<path d="M0 20h24v4H0z" fill-opacity=".36"></path></svg>
				<div>
					Draw borders
				</div>
				<div style="font-size: 14px; line-height: 16px; height: 16px; margin: 4px 0px 0px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
					Click to draw points on map
				</div>
			</div>
		</div>
	</div>
	
	<div class="drawingAction" id="newArea" onclick="setDrawSubSvgAction(&quot;newArea&quot;); createNewArea(); return false;">
		<span style="border: 10px; box-sizing: border-box; display: block; font-family: Roboto, sans-serif; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); cursor: pointer; text-decoration: none; margin: 0px; padding: 0px; outline: none; font-size: 16px; font-weight: inherit; position: relative; color: rgb(33, 33, 33); line-height: 16px; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; background: none;" tabindex="0"></span>
		<div>
			<span style="border: 10px; box-sizing: border-box; display: block; font-family: Roboto, sans-serif; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); cursor: pointer; text-decoration: none; margin: 0px; padding: 0px; outline: none; font-size: 16px; font-weight: inherit; position: relative; color: rgb(33, 33, 33); line-height: 16px; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; background: none;" tabindex="0"><span style="height: 100%; width: 100%; position: absolute; top: 0px; left: 0px; overflow: hidden; pointer-events: none; z-index: 1;"></span></span>
			<div style="margin-left: 0px; padding: 20px 16px 16px 72px; position: relative;">
				<svg id="newAreaSvg" style="display: inline-block; fill: currentcolor; height: 24px; width: 24px; user-select: none; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; position: absolute; top: 16px; left: 16px; margin-top: 10px; margin-left: 8px;" viewBox="0 0 24 24">
				<path d="M19 3H5c-1.1 0-1.99.9-1.99 2L3 19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-1 11h-4v4h-4v-4H6v-4h4V6h4v4h4v4z"></path>
				</svg><div>
					Start a new area
				</div>
				<div style="font-size: 14px; line-height: 16px; height: 16px; margin: 4px 0px 0px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
					Click here to start marking a new fence area
				</div>
			</div>
		</div>
	</div>

	
	<div class="drawingAction" id="deleteLast" onclick="setDrawSubSvgAction(&quot;deleteLast&quot;); deleteLastPoint(areacontainer_current)" style="display: block; line-height: 16px; position: relative; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; margin-left: 0px; padding: 15px 16px 16px 72px;">
		<svg style="display: inline-block; fill: currentcolor; height: 24px; width: 24px; user-select: none; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; position: absolute; top: 16px; left: 16px; margin-top: 10px; margin-left: 8px;" viewBox="0 0 24 24">
		<path d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg>
		<div>
			Delete Last Post
		</div>
		<div style="font-size: 14px; line-height: 16px; height: 16px; margin: 4px 0px 0px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
			Delete the last point on the active fence segment.
		</div>
	</div>

	<div class="drawingAction" id="gate" onclick="setDrawSubSvgAction(&quot;gate&quot;); if ( gateType === null || gateType === &quot;&quot;) { setGateStyle(1); }" style="display: block; line-height: 16px; position: relative; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; margin-left: 0px; padding: 15px 16px 16px 72px;">
		<img style="display: inline-block; fill: currentcolor; height: 24px; width: 24px; user-select: none; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; position: absolute; top: 16px; left: 16px; margin-top: 10px; margin-left: 8px;" src="./yard_measure_files/gate.png">
		<div>
			Single Gate
		</div>
		<div style="font-size: 14px; line-height: 16px; height: 16px; margin: 4px 0px 0px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
			Add a single gate.
		</div>
	</div>

	<div class="drawingAction" id="doublegate" onclick="setDrawSubSvgAction(&quot;doublegate&quot;); if ( gateDblType === null  || gateDblType === &quot;&quot;) { setGateStyle(2); }" style="display: block; line-height: 16px; position: relative; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; margin-left: 0px; padding: 15px 16px 16px 72px;">
		<img style="display: inline-block; fill: currentcolor; height: 24px; width: 24px; user-select: none; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; position: absolute; top: 16px; left: 16px; margin-top: 10px; margin-left: 8px;" src="./yard_measure_files/doublegate.png">
		<div>
			Double Gate
		</div>
		<div style="font-size: 14px; line-height: 16px; height: 16px; margin: 4px 0px 0px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
			Add a double gate.
		</div>
	</div>
	<div class="drawingAction" id="setStyleBox" onclick="setGateStyle(1, 1);setDrawSubSvgAction(&quot;setStyleBox&quot;); " style="display: block; position: relative; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; margin-left: 0px; padding: 15px 16px 16px 72px;">
		<img style="display: inline-block; fill: currentcolor; height: 24px; width: 24px; user-select: none; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; position: absolute; top: 16px; left: 16px; margin-top: 10px; margin-left: 8px;" src="./yard_measure_files/configui.png">
		<div>
			Set Gate Style
		</div>
		<div style="font-size: 14px; line-height: 16px; height: 16px; margin: 4px 0px 0px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
			Set Style of the gate.
		</div>
	</div>
	<div class="drawingAction" id="setStyleBox" onclick="setGateStyle(2, 1);setDrawSubSvgAction(&quot;setStyleBox&quot;); " style="display: block; position: relative; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; margin-left: 0px; padding: 15px 16px 16px 72px;">
		<img style="display: inline-block; fill: currentcolor; height: 24px; width: 24px; user-select: none; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; position: absolute; top: 16px; left: 16px; margin-top: 10px; margin-left: 8px;" src="./yard_measure_files/configui.png">
		<div>
			Set Double Gate Style
		</div>
		<div style="font-size: 14px; line-height: 16px; height: 16px; margin: 4px 0px 0px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
			Set Style of the gate.
		</div>
	</div>
	
	<div class="drawingAction" id="deleteBox" onclick="setDrawSubSvgAction(&quot;deleteBox&quot;); " style="display: block; position: relative; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; margin-left: 0px; padding: 15px 16px 16px 72px;">
		<img style="display: inline-block; fill: currentcolor; height: 24px; width: 24px; user-select: none; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; position: absolute; top: 16px; left: 16px; margin-top: 10px; margin-left: 8px;" src="./yard_measure_files/trash2.png">
		<div>
			Delete Gate
		</div>
		<div style="font-size: 14px; line-height: 16px; height: 16px; margin: 4px 0px 0px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
			Delete a gate.
		</div>
	</div>
	
	<div class="drawingAction" id="clearBox" onclick="clearDesign(); " style="display: block; position: relative; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; margin-left: 0px; padding: 15px 16px 16px 72px;">
		<img style="display: inline-block; fill: currentcolor; height: 24px; width: 24px; user-select: none; transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms; position: absolute; top: 16px; left: 16px; margin-top: 10px; margin-left: 8px;" src="./yard_measure_files/trash2.png">
		<div>
			Clear design
		</div>
		<div style="font-size: 14px; line-height: 16px; height: 16px; margin: 4px 0px 0px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
			Delete all fence lines and gates
		</div>
	</div>
	
	
<div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable" tabindex="-1" role="dialog" aria-labelledby="ui-dialog-title-rotate-dialog" style="display: none; z-index: 1002; outline: 0px; height: auto; width: 350px; top: 208px; left: 391.5px;"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span class="ui-dialog-title" id="ui-dialog-title-rotate-dialog">Create Array</span><a href="https://localhost:8443/sunbase/portal/widgets/fence/measure/yard_measure.jsp?nomenu=1&amp;level=18&amp;uuid=a83e6943569341f88269cb7157bb10a4p&amp;schema=fence&amp;lat=28.484535&amp;lng=-81.0891333#" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick">close</span></a></div>
				
</div>
	

<div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable" tabindex="-1" role="dialog" aria-labelledby="ui-dialog-title-delete-dialog" style="display: none; z-index: 1002; outline: 0px; height: auto; width: 300px; top: 104px; left: 422.5px;"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span class="ui-dialog-title" id="ui-dialog-title-delete-dialog">Confirmation</span><a href="https://localhost:8443/sunbase/portal/widgets/fence/measure/yard_measure.jsp?nomenu=1&amp;level=18&amp;uuid=a83e6943569341f88269cb7157bb10a4p&amp;schema=fence&amp;lat=28.484535&amp;lng=-81.0891333#" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick">close</span></a></div><div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"><div class="ui-dialog-buttonset"><button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text"><span class="ui-button-text">Confirm</span></span></button><button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text"><span class="ui-button-text">Cancel</span></span></button></div></div></div><div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable" tabindex="-1" role="dialog" aria-labelledby="ui-dialog-title-delete-all-dialog" style="display: none; z-index: 1000; outline: 0px;"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span class="ui-dialog-title" id="ui-dialog-title-delete-all-dialog">Confirmation</span><a href="https://localhost:8443/sunbase/portal/widgets/fence/measure/yard_measure.jsp?nomenu=1&amp;level=18&amp;uuid=a83e6943569341f88269cb7157bb10a4p&amp;schema=fence&amp;lat=28.484535&amp;lng=-81.0891333#" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick">close</span></a></div></div><div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable" tabindex="-1" role="dialog" aria-labelledby="ui-dialog-title-save-dialog" style="display: none; z-index: 1000; outline: 0px;"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><a href="https://localhost:8443/sunbase/portal/widgets/fence/measure/yard_measure.jsp?nomenu=1&amp;level=18&amp;uuid=a83e6943569341f88269cb7157bb10a4p&amp;schema=fence&amp;lat=28.484535&amp;lng=-81.0891333#" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick">close</span></a></div>
</div><div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable" tabindex="-1" role="dialog" aria-labelledby="ui-dialog-title-shape-dialog" style="display: none; z-index: 1000; outline: 0px;"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span class="ui-dialog-title" id="ui-dialog-title-shape-dialog">Add a Pre-defined Shape</span><a href="https://localhost:8443/sunbase/portal/widgets/fence/measure/yard_measure.jsp?nomenu=1&amp;level=18&amp;uuid=a83e6943569341f88269cb7157bb10a4p&amp;schema=fence&amp;lat=28.484535&amp;lng=-81.0891333#" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick">close</span></a></div></div><div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable" tabindex="-1" role="dialog" aria-labelledby="ui-dialog-title-rotate-dialog" style="display: none; z-index: 1002; outline: 0px; height: auto; width: 350px; top: 208px; left: 391.5px;"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span class="ui-dialog-title" id="ui-dialog-title-rotate-dialog">Rotate Polygon</span><a href="https://localhost:8443/sunbase/portal/widgets/fence/measure/yard_measure.jsp?nomenu=1&amp;level=18&amp;uuid=a83e6943569341f88269cb7157bb10a4p&amp;schema=fence&amp;lat=28.484535&amp;lng=-81.0891333#" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick">close</span></a></div>
				
			</div><div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable" tabindex="-1" role="dialog" aria-labelledby="ui-dialog-title-file-dialog" style="display: none; z-index: 1000; outline: 0px;"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span class="ui-dialog-title" id="ui-dialog-title-file-dialog">Save / Import File</span><a href="https://localhost:8443/sunbase/portal/widgets/fence/measure/yard_measure.jsp?nomenu=1&amp;level=18&amp;uuid=a83e6943569341f88269cb7157bb10a4p&amp;schema=fence&amp;lat=28.484535&amp;lng=-81.0891333#" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick">close</span></a></div></div><div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable" tabindex="-1" role="dialog" aria-labelledby="ui-dialog-title-setAreaLabel-dialog" style="display: none; z-index: 1000; outline: 0px;"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span class="ui-dialog-title" id="ui-dialog-title-setAreaLabel-dialog">Change Array Label</span><a href="https://localhost:8443/sunbase/portal/widgets/fence/measure/yard_measure.jsp?nomenu=1&amp;level=18&amp;uuid=a83e6943569341f88269cb7157bb10a4p&amp;schema=fence&amp;lat=28.484535&amp;lng=-81.0891333#" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick">close</span></a></div></div><div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable" tabindex="-1" role="dialog" aria-labelledby="ui-dialog-title-setLineLength-dialog" style="display: none; z-index: 1000; outline: 0px;"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span class="ui-dialog-title" id="ui-dialog-title-setLineLength-dialog">Set Line Length</span><a href="https://localhost:8443/sunbase/portal/widgets/fence/measure/yard_measure.jsp?nomenu=1&amp;level=18&amp;uuid=a83e6943569341f88269cb7157bb10a4p&amp;schema=fence&amp;lat=28.484535&amp;lng=-81.0891333#" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick">close</span></a></div></div><ul class="ui-autocomplete ui-menu ui-widget ui-widget-content ui-corner-all" role="listbox" aria-activedescendant="ui-active-menuitem" style="z-index: 1; top: 0px; left: 0px; display: none;"></ul><div id="sCLExtInstalled" data-version="3.9" style="display: none;">1</div><span style="border-radius: 3px; text-indent: 20px; width: auto; padding: 0px 4px 0px 0px; text-align: center; font-style: normal; font-variant: normal; font-weight: bold; font-stretch: normal; font-size: 11px; line-height: 20px; font-family: &quot;Helvetica Neue&quot;, Helvetica, sans-serif; color: rgb(255, 255, 255); background: url(&quot;data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzBweCIgd2lkdGg9IjMwcHgiIHZpZXdCb3g9Ii0xIC0xIDMxIDMxIj48Zz48cGF0aCBkPSJNMjkuNDQ5LDE0LjY2MiBDMjkuNDQ5LDIyLjcyMiAyMi44NjgsMjkuMjU2IDE0Ljc1LDI5LjI1NiBDNi42MzIsMjkuMjU2IDAuMDUxLDIyLjcyMiAwLjA1MSwxNC42NjIgQzAuMDUxLDYuNjAxIDYuNjMyLDAuMDY3IDE0Ljc1LDAuMDY3IEMyMi44NjgsMC4wNjcgMjkuNDQ5LDYuNjAxIDI5LjQ0OSwxNC42NjIiIGZpbGw9IiNmZmYiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLXdpZHRoPSIxIj48L3BhdGg+PHBhdGggZD0iTTE0LjczMywxLjY4NiBDNy41MTYsMS42ODYgMS42NjUsNy40OTUgMS42NjUsMTQuNjYyIEMxLjY2NSwyMC4xNTkgNS4xMDksMjQuODU0IDkuOTcsMjYuNzQ0IEM5Ljg1NiwyNS43MTggOS43NTMsMjQuMTQzIDEwLjAxNiwyMy4wMjIgQzEwLjI1MywyMi4wMSAxMS41NDgsMTYuNTcyIDExLjU0OCwxNi41NzIgQzExLjU0OCwxNi41NzIgMTEuMTU3LDE1Ljc5NSAxMS4xNTcsMTQuNjQ2IEMxMS4xNTcsMTIuODQyIDEyLjIxMSwxMS40OTUgMTMuNTIyLDExLjQ5NSBDMTQuNjM3LDExLjQ5NSAxNS4xNzUsMTIuMzI2IDE1LjE3NSwxMy4zMjMgQzE1LjE3NSwxNC40MzYgMTQuNDYyLDE2LjEgMTQuMDkzLDE3LjY0MyBDMTMuNzg1LDE4LjkzNSAxNC43NDUsMTkuOTg4IDE2LjAyOCwxOS45ODggQzE4LjM1MSwxOS45ODggMjAuMTM2LDE3LjU1NiAyMC4xMzYsMTQuMDQ2IEMyMC4xMzYsMTAuOTM5IDE3Ljg4OCw4Ljc2NyAxNC42NzgsOC43NjcgQzEwLjk1OSw4Ljc2NyA4Ljc3NywxMS41MzYgOC43NzcsMTQuMzk4IEM4Ljc3NywxNS41MTMgOS4yMSwxNi43MDkgOS43NDksMTcuMzU5IEM5Ljg1NiwxNy40ODggOS44NzIsMTcuNiA5Ljg0LDE3LjczMSBDOS43NDEsMTguMTQxIDkuNTIsMTkuMDIzIDkuNDc3LDE5LjIwMyBDOS40MiwxOS40NCA5LjI4OCwxOS40OTEgOS4wNCwxOS4zNzYgQzcuNDA4LDE4LjYyMiA2LjM4NywxNi4yNTIgNi4zODcsMTQuMzQ5IEM2LjM4NywxMC4yNTYgOS4zODMsNi40OTcgMTUuMDIyLDYuNDk3IEMxOS41NTUsNi40OTcgMjMuMDc4LDkuNzA1IDIzLjA3OCwxMy45OTEgQzIzLjA3OCwxOC40NjMgMjAuMjM5LDIyLjA2MiAxNi4yOTcsMjIuMDYyIEMxNC45NzMsMjIuMDYyIDEzLjcyOCwyMS4zNzkgMTMuMzAyLDIwLjU3MiBDMTMuMzAyLDIwLjU3MiAxMi42NDcsMjMuMDUgMTIuNDg4LDIzLjY1NyBDMTIuMTkzLDI0Ljc4NCAxMS4zOTYsMjYuMTk2IDEwLjg2MywyNy4wNTggQzEyLjA4NiwyNy40MzQgMTMuMzg2LDI3LjYzNyAxNC43MzMsMjcuNjM3IEMyMS45NSwyNy42MzcgMjcuODAxLDIxLjgyOCAyNy44MDEsMTQuNjYyIEMyNy44MDEsNy40OTUgMjEuOTUsMS42ODYgMTQuNzMzLDEuNjg2IiBmaWxsPSIjYmQwODFjIj48L3BhdGg+PC9nPjwvc3ZnPg==&quot;) 3px 50% / 14px 14px no-repeat rgb(189, 8, 28); position: absolute; opacity: 1; z-index: 8675309; display: none; cursor: pointer; border: none; -webkit-font-smoothing: antialiased;">Save</span><span style="border-radius: 3px; text-indent: 20px; width: 20px; height: 20px; background: url(&quot;data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHdpZHRoPSIzMHB4IiBoZWlnaHQ9IjMwcHgiIHZpZXdCb3g9IjAgMCAzMCAzMCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KPGc+CjxwYXRoIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLXdpZHRoPSI0IiBkPSJNMTcsMTcgTDIyLDIyIFogIi8+CjxjaXJjbGUgc3Ryb2tlPSIjZmZmIiBjeD0iMTMiIGN5PSIxMyIgcj0iNiIgZmlsbD0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIzLjUiLz4KPHBhdGggZmlsbD0iI2ZmZiIgZD0iTTAsMCBMOCwwIEw4LDMgTDMsMyBMMyw4IEwwLDggWiIvPgo8cGF0aCBmaWxsPSIjZmZmIiBkPSJNMzAsMjIgTDMwLDMwIEwyMiwzMCBMMjIsMjcgTDI3LDI3IEwyNywyMiBaIi8+CjxwYXRoIGZpbGw9IiNmZmYiIGQ9Ik0zMCwwIEwzMCw4IEwyNyw4IEwyNywzIEwyMiwzIEwyMiwwIFoiLz4KPHBhdGggZmlsbD0iI2ZmZiIgZD0iTTAsMjIgTDMsMjIgTDMsMjcgTDgsMjcgTDgsMzAgTDAsMzBaIi8+CjwvZz4KPC9zdmc+Cg==&quot;) 50% 50% / 14px 14px no-repeat rgba(0, 0, 0, 0.4); position: absolute; opacity: 1; z-index: 8675309; display: none; cursor: pointer; border: none;"></span>
<script>			
function saveDesign()
{
	var data = [];
	
	for ( var i = 0; i < areacontainer.length; ++i )
	{
		var set = [];
		for ( var j = 0; j < areacontainer[i].length; ++j )
		{
			set.push( areacontainer[i][j] );
		}
		
		var block = {};
		block['set'] = set;
		data.push( block );
	}	
	
	var root = {};
	root['data'] = data;
	root['lat'] = map.getCenter().lat();
	root['lng'] = map.getCenter().lng();
	
	root['gateType'] = gateType;
	root['gateDblType'] = gateDblType;
	root['fenceType'] = fenceType;
	root['fencePermiter'] = $('.fencePermiter').html();
	
	
	root['design_uuid'] = 'a83e6943569341f88269cb7157bb10a4p';

	var markers = [];
	for ( var i = 0; i < canvasMarkers.length; ++i )
	{
		var d = {};
		d['lat'] = canvasMarkers[i].position.lat();
		d['lng'] = canvasMarkers[i].position.lng();
		d['uuid'] = canvasMarkers[i].uuid;
		d['img'] = canvasMarkers[i].icon.url;
		d['pinType'] = canvasMarkers[i].pinType;		
		markers.push( d ); 
	}
	root['markers'] = markers;
	
	$.ajax({
		url: "yarddesign_cmd.jsp", 
		type: "POST",             
		data: "cmd=design&uuid=a83e6943569341f88269cb7157bb10a4p&data_set=" + escape( JSON.stringify(root) ) + '&schema=fence',
		success: function(data2) {
//			xdInfo("Design saved");
			
			if ( window.opener != null )
			{
				if ( typeof window.opener.designerUpdatedExternally === "function" )
					window.opener.designerUpdatedExternally();
			}
			
		}
  });
	
}

function pvwatts()
{}

function loadDataSet(s)
{
	if ( s['lat'] )
	{
		map.setCenter({lat:s['lat'], lng:s['lng']});
		gateType  = s['gateType'];
		gateDblType = s['gateDblType'];
		fenceType = s['fenceType'];
		fencePermiter = s['fencePermiter'];

	}
	if ( s['markers'] )
	{
		for ( var i = 0; i < s['markers'].length; ++i )
		{
			var pin = s['markers'][i]['img'];
			if ( s['markers'][i]['pinType'] )
				pin = s['markers'][i]['pinType'];
			
/*			
			if ( pin.indexOf('inverter') != -1 )
				pin = 'inverter';	
			else if ( pin.indexOf('battery') != -1 )
				pinIcon = 'battery';	
			else if ( pin.indexOf('meter') != -1 )
				pinIcon = 'meter';
*/			
			createPoint( s['markers'][i]['lat'], s['markers'][i]['lng'], pin );
		}
	}


	var set = s['data'];
	if ( set !== undefined && set !== null & set.length > 0 ) 
	{ 
		areacontainer = [];
		for ( var i = 0; i < set.length; ++i )
		{
			areacontainer_current = i;
			try {
				createNewArea();
			}
			catch(e){ console.log(e); }
			
			for ( var j = 0; j < set[i]['set'].length; ++j )
			{
				var result = set[i]['set'][j];
	//			console.log("PT " + result.lat + "," + result.lng );
				areacontainer[areacontainer_current].push( new google.maps.LatLng(result.lat, result.lng) );
			}
			display();
			$(".context-menu").css('visibility','hidden');
		}
	}
}


var loaded = false;
var attempt = 0;
function loadDataSetFile()
{
	++attempt;
	
	if ( attempt > 10 ) 
	{
		console.log("TEST");
		return;
	}
	if ( !overlay.getProjection )
		setTimeout( function(e) { loadDataSetFile(); },500);
	else if ( loaded == false )
	{
		loaded = true;
		loadDataSet(set);
	}
}
var set = '';



function createQuote(productFence, permiter, fenceCost, gate, gateCount, gateCost, dblGate, gateDblCount, gateDblCost )
{
	var data = '';
	var item = 1;
	if ( productFence )
	{
		data =  '&item_' + item + '=' + productFence.uuid;
		data += '&item_' + item + '_qty=' + permiter;
		data += '&item_' + item + '_desc=' + escape( productFence.name );

		if ( productFence.loadedCost === undefined || productFence.loadedCost == 0 )
		{
			data += '&item_' + item + '_cost=' + ( productFence.retailPrice + productFence.installationCost );
		}
		else
		{
			data += '&item_' + item + '_cost=' + productFence.loadedCost;
		}
		data += '&item_' + item + '_total_cost=' + fenceCost;
		++item;
	}
	
	if ( gate )
	{
		data =  '&item_' + item + '=' + gate.uuid;
		data += '&item_' + item + '_qty=' + gateCount;
		data += '&item_' + item + '_desc=' + escape( gate.name );
		if ( gate.loadedCost === undefined || gate.loadedCost == 0 )
		{
			data += '&item_' + item + '_cost=' + ( gate.retailPrice + gate.installationCost );
		}
		else
		{
			data += '&item_' + item + '_cost=' + gate.loadedCost;
		}
		data += '&item_' + item + '_total_cost=' + gateCost;
		++item;
	}
	if ( dblGate )
	{
		data =  '&item_' + item + '=' + dblGate.uuid;
		data += '&item_' + item + '_qty=' + gateDblCount;
		data += '&item_' + item + '_desc=' + escape( dblGate.name );
		if ( dblGate.loadedCost === undefined || dblGate.loadedCost == 0 )
		{
			data += '&item_' + item + '_cost=' + ( dblGate.retailPrice + dblGate.installationCost );
		}
		else
		{
			data += '&item_' + item + '_cost=' + dblGate.loadedCost;
		}
		data += '&item_' + item + '_total_cost=' + gateDblCost;
		++item;
	}
	
	if ( item > 0 )
	{
		$.ajax({
				type: "POST",
				url: "yarddesign_cmd.jsp",
				data: 'cmd=quote&key=a83e6943569341f88269cb7157bb10a4p&schema=fence' +
					  data,
				success: function (data) {
					if ( data.indexOf("ucc") != - 1)
						console.log("Created Quote");
					else
						xdError( data );
				}
		});
	}
}

function thousands_separators(num)
{
    var num_parts = parseFloat(num).toFixed(2).toString().split(".");
    num_parts[0] = num_parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
	if ( num_parts.length == 2 )
	{
		if ( num_parts[1].length == 1 )
			num_parts[1] = num_parts[1] + "0";
	}
    return num_parts.join(".");
}


function closeInstructions()
{	 
	$('.instructionsDiv').hide();
}
</script>	

	
<div class="instructionsDiv modalPanelBackground" style="display: none;">
	 
	 <div id="instructions" style="display: none;">
	    <br><br>
	    <b>Step 1</b>: Click once on the map to start your fence. Click again on the map to continue your fence.<br><br>
		<b>Step 2</b>: Click Select Style and make your selection.<br><br>
		For more advanced help, <span id="advHelpBtn">click here</span>.
		
		<br><br>
		<div class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button">
			<button onclick="closeInstructions()" class="ui-button-text ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" style="font-size:22px" role="button" aria-disabled="false"><span class="ui-button-text">Let's Get Started.</span></button>
		</div>
	 </div>
</div>


<script>
setTimeout( function(e){ document.getElementById('instructions').style = 'display:block'; }, 500 );
</script></div></div><div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable" tabindex="-1" role="dialog" aria-labelledby="ui-dialog-title-rotate-dialog" style="display: none; z-index: 1000; outline: 0px;"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span class="ui-dialog-title" id="ui-dialog-title-rotate-dialog">&nbsp;</span><a href="https://localhost:8443/sunbase/portal/widgets/fence/measure/yard_measure.jsp?nomenu=1&amp;level=18&amp;uuid=a83e6943569341f88269cb7157bb10a4p&amp;schema=fence&amp;lat=28.484535&amp;lng=-81.0891333#" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick">close</span></a></div><div id="rotate-dialog" class="ui-dialog-content ui-widget-content" style="width: auto; min-height: 50.8px; height: auto;" scrolltop="0" scrollleft="0">			
				<form id="rotate-form" style="" onsubmit="return false">
					<table>
						<tbody><tr>
							<td>Direction of the roof </td><td><select name="_direct" style="height:25px" id="_direct" onchange="changeDir()">
							<option value="S">South</option>
							<option value="SE">SouthEast</option>
							<option value="SW">SouthWest</option>
							<option value="West">West</option>
							<option value="East">East</option>
							<option value="N">North</option>
							</select><br></td>
						</tr>
						<tr>
							<td>Azimuth (Degrees) <br></td><td><input type="number" name="_azimuth" value="180" id="_azimuth"> </td>							
						</tr>
						<tr>
							<td>Max # of Panels <br></td><td><input type="number" name="_panel" value="30" id="_panel"> </td>							
						</tr>
						<tr>
							<td>Roof Pitch <br></td><td>							
								<select id="_roofPitch" onchange="renderPanels(&quot;map&quot;, null)" style="box-sizing: border-box; z-index: 2; height: 25px; left: 0px; top: 0px; border: 1px solid rgb(158, 171, 196); font-family: Lato; font-size: 14px; border-radius: 3px; transition: border-color 200ms ease 0s, box-shadow 200ms ease 0s; box-shadow: none;" tabindex="4">
												<option class="dropdown-choice dropdown-placeholder" value="&quot;PLACEHOLDER_1427118222253&quot;" style="color: rgb(158, 171, 196); display: none;" disabled="">Select Pitch</option>
												<option selected="true" class="dropdown-choice" value="04.76">1:12</option>
												<option class="dropdown-choice" value="09.46">2:12</option>
												<option class="dropdown-choice" value="14.04">3:12</option>
												<option class="dropdown-choice" value="18.43">4:12</option>
												<option class="dropdown-choice" value="22.62">5:12</option>
												<option class="dropdown-choice" value="26.57">6:12</option>
												<option class="dropdown-choice" value="30.26">7:12</option>
												<option class="dropdown-choice" value="33.69">8:12</option>
												<option class="dropdown-choice" value="36.37">9:12</option>
												<option class="dropdown-choice" value="39.81">10:12</option>
												<option class="dropdown-choice" value="42.51">11:12</option>
												<option class="dropdown-choice" value="45">12:12</option>
											</select>

						</td></tr>
					</tbody></table>
				</form>
			</div></div><div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable" tabindex="-1" role="dialog" aria-labelledby="ui-dialog-title-delete-dialog" style="display: none; z-index: 1000; outline: 0px;"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span class="ui-dialog-title" id="ui-dialog-title-delete-dialog">&nbsp;</span><a href="https://localhost:8443/sunbase/portal/widgets/fence/measure/yard_measure.jsp?nomenu=1&amp;level=18&amp;uuid=a83e6943569341f88269cb7157bb10a4p&amp;schema=fence&amp;lat=28.484535&amp;lng=-81.0891333#" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick">close</span></a></div><div id="delete-dialog" class="ui-dialog-content ui-widget-content" style="width: auto; min-height: 50.8px; height: auto;" scrolltop="0" scrollleft="0">Are you sure you want to delete this array?</div></div><div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable" tabindex="-1" role="dialog" aria-labelledby="ui-dialog-title-delete-all-dialog" style="display: none; z-index: 1000; outline: 0px;"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span class="ui-dialog-title" id="ui-dialog-title-delete-all-dialog">&nbsp;</span><a href="https://localhost:8443/sunbase/portal/widgets/fence/measure/yard_measure.jsp?nomenu=1&amp;level=18&amp;uuid=a83e6943569341f88269cb7157bb10a4p&amp;schema=fence&amp;lat=28.484535&amp;lng=-81.0891333#" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick">close</span></a></div><div id="delete-all-dialog" class="ui-dialog-content ui-widget-content">Are you sure you want to clear the map?</div></div><div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable" tabindex="-1" role="dialog" aria-labelledby="ui-dialog-title-shape-dialog" style="display: none; z-index: 1000; outline: 0px;"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span class="ui-dialog-title" id="ui-dialog-title-shape-dialog">&nbsp;</span><a href="https://localhost:8443/sunbase/portal/widgets/fence/measure/yard_measure.jsp?nomenu=1&amp;level=18&amp;uuid=a83e6943569341f88269cb7157bb10a4p&amp;schema=fence&amp;lat=28.484535&amp;lng=-81.0891333#" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick">close</span></a></div><div id="shape-dialog" class="ui-dialog-content ui-widget-content">			
			</div></div><div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable" tabindex="-1" role="dialog" aria-labelledby="ui-dialog-title-rotate-dialog" style="display: none; z-index: 1000; outline: 0px;"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span class="ui-dialog-title" id="ui-dialog-title-rotate-dialog">&nbsp;</span><a href="https://localhost:8443/sunbase/portal/widgets/fence/measure/yard_measure.jsp?nomenu=1&amp;level=18&amp;uuid=a83e6943569341f88269cb7157bb10a4p&amp;schema=fence&amp;lat=28.484535&amp;lng=-81.0891333#" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick">close</span></a></div><div id="rotate-dialog" class="ui-dialog-content ui-widget-content" style="width: auto; min-height: 50.8px; height: auto;" scrolltop="0" scrollleft="0">			
			</div></div><div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable" tabindex="-1" role="dialog" aria-labelledby="ui-dialog-title-file-dialog" style="display: none; z-index: 1000; outline: 0px;"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span class="ui-dialog-title" id="ui-dialog-title-file-dialog">&nbsp;</span><a href="https://localhost:8443/sunbase/portal/widgets/fence/measure/yard_measure.jsp?nomenu=1&amp;level=18&amp;uuid=a83e6943569341f88269cb7157bb10a4p&amp;schema=fence&amp;lat=28.484535&amp;lng=-81.0891333#" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick">close</span></a></div><div id="file-dialog" class="ui-dialog-content ui-widget-content">
			</div></div><div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable" tabindex="-1" role="dialog" aria-labelledby="ui-dialog-title-setAreaLabel-dialog" style="display: none; z-index: 1000; outline: 0px;"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span class="ui-dialog-title" id="ui-dialog-title-setAreaLabel-dialog">&nbsp;</span><a href="https://localhost:8443/sunbase/portal/widgets/fence/measure/yard_measure.jsp?nomenu=1&amp;level=18&amp;uuid=a83e6943569341f88269cb7157bb10a4p&amp;schema=fence&amp;lat=28.484535&amp;lng=-81.0891333#" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick">close</span></a></div><div id="setAreaLabel-dialog" class="ui-dialog-content ui-widget-content">			
				<form id="label-form" onsubmit="return false">
					<table>
						<tbody><tr>
							<td>Label: <input type="text" name="label" id="label"></td>
						</tr>
					</tbody></table>
				</form>
			</div></div><div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable" tabindex="-1" role="dialog" aria-labelledby="ui-dialog-title-setLineLength-dialog" style="display: none; z-index: 1000; outline: 0px;"><div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span class="ui-dialog-title" id="ui-dialog-title-setLineLength-dialog">&nbsp;</span><a href="https://localhost:8443/sunbase/portal/widgets/fence/measure/yard_measure.jsp?nomenu=1&amp;level=18&amp;uuid=a83e6943569341f88269cb7157bb10a4p&amp;schema=fence&amp;lat=28.484535&amp;lng=-81.0891333#" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick">close</span></a></div><div id="setLineLength-dialog" class="ui-dialog-content ui-widget-content">


				
				
			</div></div><ul class="ui-autocomplete ui-menu ui-widget ui-widget-content ui-corner-all" role="listbox" aria-activedescendant="ui-active-menuitem" style="z-index: 1; top: 0px; left: 0px; display: none;"></ul></body></html>